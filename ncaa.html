<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Garry Chan">
  <meta name="description" content="Posts by Garry Chan">
  <!-- mathjax for $ -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        processEscapes: true
      }
    });
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>
  <title>
    Garry's Blog
&ndash; March Madness  </title>

    <link rel="canonical" href="https://garrrychan.github.io/blog/ncaa.html">

  <link href="//fonts.googleapis.com/css?family=Open+Sans:600,800" rel="stylesheet" type="text/css">
  <!------>
  <link rel="shortcut icon" href="https://garrrychan.github.io/blog/theme/images/gary_snail.png">  <link rel="stylesheet" type="text/css" href="https://garrrychan.github.io/blog/theme/css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="https://garrrychan.github.io/blog/theme/css/all.css">
  <link rel="stylesheet" type="text/css" href="https://garrrychan.github.io/blog/theme/css/pygments-monokai.css">
</head>
<body>
  <div class="container">
    <div class="four columns sidebar">
<nav>
  <a href="https://garrrychan.github.io/blog/">
    <img src="https://garrrychan.github.io/blog/theme/images/logo2.jpg" id="gravatar" alt="photo"/>
  </a>
  <h2><a href="https://garrrychan.github.io/blog/">Garry Chan</a></h2>

  <div id="bio">
    <p>I write about data science & sports.</p>
    <p>Currently, I'm a Data Scientist at Creative Destruction Lab.</p>
    <p>Experience as a tech consultant, with a Bachelors in Mathematics from UWaterloo.</p>
  </div>

  <div id="social">
    <div>
      <i class="fas fa-map-marker-alt fa-2x" style="color:#ddd">
      <span class="location_icon"> <font color=#000> Toronto, Canada </font></span> </i>
      </div>
    <br>
    <a title="Garry on LinkedIn" href="https://www.linkedin.com/in/garrrychan">
      <!--- icons from font awesome are really just fonts fa-2x the size--->
    <i class="fab fa-linkedin fa-2x"></i></a>

    &nbsp &nbsp;
    <a title="Garry on Github" href="https://github.com/garrrychan">
    <i class="fab fa-github fa-2x"></i></a>

    &nbsp &nbsp;
    <a title="Garry's Email" href="mailto: g33chan@uwaterloo.ca">
    <i class="fas fa-envelope-square fa-2x"></i>
    </a>
  </div>
</nav>    </div>

    <div class="eleven columns content">
  <p class="meta">
    18 April 2019
    <a href="https://garrrychan.github.io/blog">
      <!--- home icon--->
      <i class="home fa fa-home fa-2x"></i>
    </a>
  </p>

  <h1 class="title"><a href="https://garrrychan.github.io/blog/ncaa.html">March Madness</a></h1>

  <div class="article_text" id="post">
    <p>How likely is a team to make the Final Four of the NCAA Tournament?</p>
<h1>Introduction</h1>
<p>Each year, close to $4 billion is wagered on the NCAA Division 1 men's basketball tournament. Most of that money is wagered where the objective is to correctly predict winners of each game, with emphasis on the last four teams remaining (the Final Four). </p>
<p>In this project, my motivation is the following:</p>
<blockquote>
<p>Based on a college's regular season performance and seeding information, can I predict whether or not they will reach the final four? 
<br>
<br></p>
</blockquote>
<p>What are the variables that are correlated to predicting teams that make it to the final four? As a corollary, my model will also output the associated probabilities of making it to the final 4. Am I able to outperform a naive model? As even the sport pundits will tell you, since 2008, 53% of the time, at least 2 No. 1 seeds make the final four. So just by choosing two No 1. seeds, you're half way there.</p>
<p>As a trusted advisor to Coach Krzyzewski (Duke) or Coach Izzo (Michigan State), how would I recommend spending time developing the team? </p>
<p>Or at the very least, how do I improve my 2020 bracket to make some money?</p>
<hr>
<h1>Preprocessing</h1>
<h2>Import libraries</h2>
<div class="highlight"><pre><span></span><span class="c1"># data wrangling</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c1"># plotting </span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;fivethirtyeight&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>

<span class="c1"># preprocessing &amp; feature engineering</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">LabelBinarizer</span><span class="p">,</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn_pandas</span> <span class="kn">import</span> <span class="n">DataFrameMapper</span><span class="p">,</span> <span class="n">CategoricalImputer</span><span class="p">,</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">RandomOverSampler</span>

<span class="c1"># modelling &amp; evaluation</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>

<span class="c1"># scientific notation off</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">suppress</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;{:.2f}&#39;</span><span class="o">.</span><span class="n">format</span>

<span class="c1"># suppress warnings</span>
<span class="kn">from</span> <span class="nn">sklearn.exceptions</span> <span class="kn">import</span> <span class="n">DataConversionWarning</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>


<hr>
<h2>Data</h2>
<p>The data spans 2003 to 2017 and is compiled from <a href="https://www.sports-reference.com/cbb/schools/virginia/2019-gamelogs.html">sports-reference.com</a>. </p>
<p>The data is spread across four files:</p>
<ul>
<li><code>regular_season.csv</code> - gamelogs for every regular season game</li>
<li><code>teams.csv</code> - team_id, names, and conferences</li>
<li><code>march_madness.csv</code> - gamelogs for each NCAA tournament game</li>
<li><code>march_madness_seeds.csv</code> - entry seeds for each team (W, X, Y, Z indicate the region)</li>
</ul>
<h3>Understand the data</h3>
<div class="highlight"><pre><span></span><span class="n">regular</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/ncaa_data/regular_season.csv&quot;</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">regular</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>day_in_season</th>
      <th>winning_team_id</th>
      <th>winning_team_score</th>
      <th>losing_team_id</th>
      <th>losing_team_score</th>
      <th>winning_team_field_goals</th>
      <th>winning_team_field_goals_attempted</th>
      <th>winning_team_three_points</th>
      <th>winning_team_three_points_attempted</th>
      <th>winning_team_free_throws</th>
      <th>winning_team_free_throws_attempted</th>
      <th>winning_team_offensive_rebounds</th>
      <th>winning_team_defensive_rebounds</th>
      <th>winning_team_assists</th>
      <th>winning_team_turnovers</th>
      <th>winning_team_steals</th>
      <th>winning_team_blocks</th>
      <th>winning_team_personal_fouls</th>
      <th>losing_team_field_goals</th>
      <th>losing_team_field_goals_attempted</th>
      <th>losing_team_three_points</th>
      <th>losing_team_three_points_attempted</th>
      <th>losing_team_free_throws</th>
      <th>losing_team_free_throws_attempted</th>
      <th>losing_team_offensive_rebounds</th>
      <th>losing_team_defensive_rebounds</th>
      <th>losing_team_assists</th>
      <th>losing_team_turnovers</th>
      <th>losing_team_steals</th>
      <th>losing_team_blocks</th>
      <th>losing_team_personal_fouls</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>76633</th>
      <td>2017</td>
      <td>132</td>
      <td>1348</td>
      <td>70</td>
      <td>1433</td>
      <td>63</td>
      <td>24</td>
      <td>54</td>
      <td>8</td>
      <td>20</td>
      <td>14</td>
      <td>19</td>
      <td>9</td>
      <td>27</td>
      <td>12</td>
      <td>6</td>
      <td>3</td>
      <td>7</td>
      <td>18</td>
      <td>21</td>
      <td>67</td>
      <td>4</td>
      <td>14</td>
      <td>17</td>
      <td>22</td>
      <td>23</td>
      <td>24</td>
      <td>8</td>
      <td>5</td>
      <td>4</td>
      <td>1</td>
      <td>16</td>
    </tr>
    <tr>
      <th>76634</th>
      <td>2017</td>
      <td>132</td>
      <td>1374</td>
      <td>71</td>
      <td>1153</td>
      <td>56</td>
      <td>26</td>
      <td>52</td>
      <td>10</td>
      <td>19</td>
      <td>9</td>
      <td>13</td>
      <td>7</td>
      <td>27</td>
      <td>14</td>
      <td>8</td>
      <td>2</td>
      <td>6</td>
      <td>15</td>
      <td>19</td>
      <td>61</td>
      <td>4</td>
      <td>24</td>
      <td>14</td>
      <td>18</td>
      <td>17</td>
      <td>22</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>1</td>
      <td>13</td>
    </tr>
    <tr>
      <th>76635</th>
      <td>2017</td>
      <td>132</td>
      <td>1407</td>
      <td>59</td>
      <td>1402</td>
      <td>53</td>
      <td>21</td>
      <td>60</td>
      <td>1</td>
      <td>17</td>
      <td>16</td>
      <td>19</td>
      <td>14</td>
      <td>19</td>
      <td>5</td>
      <td>5</td>
      <td>10</td>
      <td>3</td>
      <td>10</td>
      <td>20</td>
      <td>48</td>
      <td>6</td>
      <td>17</td>
      <td>7</td>
      <td>8</td>
      <td>9</td>
      <td>27</td>
      <td>10</td>
      <td>17</td>
      <td>1</td>
      <td>7</td>
      <td>18</td>
    </tr>
  </tbody>
</table>

<p>Let's interpret the last row.
- 1407 = Troy, 1402 = Texas State.
- Troy beat Texas State 59 to 53 on 132 day in season which is Sunday, March 2017. (Technically, 2016 - 2017 Season). Notice that all games finish on day 132 in each year.</p>
<p>From the regular season, there are:</p>
<ul>
<li>32 variables</li>
<li>games from 2003 to 2017</li>
<li>stats per each team, team id</li>
<li>no null values, all ints</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/ncaa_data/teams.csv&quot;</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">teams</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>team_id</th>
      <th>team_name</th>
      <th>conference_code</th>
      <th>conference_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2014</td>
      <td>1101</td>
      <td>Abilene Chr</td>
      <td>southland</td>
      <td>Southland Conference</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015</td>
      <td>1101</td>
      <td>Abilene Chr</td>
      <td>southland</td>
      <td>Southland Conference</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2016</td>
      <td>1101</td>
      <td>Abilene Chr</td>
      <td>southland</td>
      <td>Southland Conference</td>
    </tr>
  </tbody>
</table>

<div class="highlight"><pre><span></span><span class="n">teams</span> <span class="o">=</span> <span class="n">teams</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;conference_name&quot;</span><span class="p">])</span>
</pre></div>


<p>From the teams data:
<ul> 
    <li> join team name, conference code to easily interpret </li>
    <li> drop conference name, it's redundant </li>
    <li> conference info from 2003 to 2018 </li>
    <li> no null values, int and object looks good </li>
</ul></p>
<div class="highlight"><pre><span></span><span class="n">mm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/ncaa_data/march_madness.csv&quot;</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">mm</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>day_in_season</th>
      <th>winning_team_id</th>
      <th>winning_team_score</th>
      <th>losing_team_id</th>
      <th>losing_team_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1985</td>
      <td>136</td>
      <td>1116</td>
      <td>63</td>
      <td>1234</td>
      <td>54</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1985</td>
      <td>136</td>
      <td>1120</td>
      <td>59</td>
      <td>1345</td>
      <td>58</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1985</td>
      <td>136</td>
      <td>1207</td>
      <td>68</td>
      <td>1250</td>
      <td>43</td>
    </tr>
  </tbody>
</table>

<p>From the march madness data:
<ul>
<li> 1985 to 2017 data about game logs for NCAA tournament </li>
<li> scores, winning team &amp; losing team </li>
<li> use 1985 -&gt; 2017 data to predict 2018 </li>
<li> day 134, 135 are for first four, associated with 'a', 'b' seeds, they play to finalize seeding for final 64 </li>
<li> e.g. 11 Wake Forest 88, 11 Kansas State 95 </li>
<li> first day of round of 64 is 136 </li>
<li> last game is 154, which is the national champion </li>
<li> e.g. UNC beat Gonzaga on Day 154 in 2017 </li>
<li> Let's drop 1985-&gt;2002 data, since I don't have regular season, seed or conference information for those years. </li>
</ul></p>
<div class="highlight"><pre><span></span><span class="n">mm</span> <span class="o">=</span> <span class="n">mm</span><span class="p">[</span><span class="n">mm</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">2003</span><span class="p">]</span>
<span class="n">seeds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/ncaa_data/march_madness_seeds.csv&quot;</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">seeds</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>seed</th>
      <th>team_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2003</td>
      <td>W01</td>
      <td>1328</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2003</td>
      <td>W02</td>
      <td>1448</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2003</td>
      <td>W03</td>
      <td>1393</td>
    </tr>
  </tbody>
</table>

<ul>
<li>seed information from 2003 to 2018</li>
<li>there are 68 seeds</li>
<li>Starting in 2011, NCAA tournament starts with 68 teams (e.g. 68 seeds), then dwindles down to 64.</li>
<li>8 lowest seeded teams play in the ‘first four’, and then the winners, come out to be apart of the 64.</li>
<li>merge to use seed as a variable, join on team_id</li>
<li>seed needs to be an int; let's remove the region, it doesn't really matter, what we care about are the raw seeds, treat Y16a and Y16b as 16</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">seeds</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seeds</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">seeds</span><span class="p">,</span> <span class="n">teams</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">seed_and_names</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>seed</th>
      <th>team_id</th>
      <th>team_name</th>
      <th>conference_code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2003</td>
      <td>1</td>
      <td>1328</td>
      <td>Oklahoma</td>
      <td>big_twelve</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2003</td>
      <td>2</td>
      <td>1448</td>
      <td>Wake Forest</td>
      <td>acc</td>
    </tr>
    <tr>
      <th>56</th>
      <td>2003</td>
      <td>3</td>
      <td>1393</td>
      <td>Syracuse</td>
      <td>big_east</td>
    </tr>
  </tbody>
</table>

<ul>
<li>I need a label to indicate if the team is in the Final Four</li>
<li>e.g. in 2017, the Final Four were Gonzaga, South Carolina, Oregon and North Carolina</li>
<li>1211, 1376, 1322, 1314 respectively</li>
<li>So, we can see that on day 154, the national championship game was played, and the winner was North Carolina</li>
<li>Moreover, the final four teams are North Carolina vs Oregon, and Gonzaga vs South Carolina</li>
<li>These correspond to games played on 152</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">HTML</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">mm</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">==</span><span class="mi">2017</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>day_in_season</th>
      <th>winning_team_id</th>
      <th>winning_team_score</th>
      <th>losing_team_id</th>
      <th>losing_team_score</th>
      <th>final_four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2112</th>
      <td>2017</td>
      <td>146</td>
      <td>1314</td>
      <td>75</td>
      <td>1246</td>
      <td>73</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2113</th>
      <td>2017</td>
      <td>146</td>
      <td>1376</td>
      <td>77</td>
      <td>1196</td>
      <td>70</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2114</th>
      <td>2017</td>
      <td>152</td>
      <td>1211</td>
      <td>77</td>
      <td>1376</td>
      <td>73</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2115</th>
      <td>2017</td>
      <td>152</td>
      <td>1314</td>
      <td>77</td>
      <td>1332</td>
      <td>76</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2116</th>
      <td>2017</td>
      <td>154</td>
      <td>1314</td>
      <td>71</td>
      <td>1211</td>
      <td>65</td>
      <td>0</td>
    </tr>
  </tbody>
</table>

<p>We can see the championship game was also played on 154, final four played on 152! 
Perfect, now we can flag all of these teams as final four = 1</p>
<p>We'll query the winning_team_id and losing_team_id for each of those games to get the final four teams</p>
<div class="highlight"><pre><span></span><span class="c1"># 15 seasons, we should get 2*15 = 30 final four games</span>
<span class="n">mm</span><span class="p">[</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">mm</span><span class="p">[</span><span class="s2">&quot;day_in_season&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">152</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>


<hr>
<h2>Define X and y</h2>
<p>Let's define X and y so we can more easily perform EDA, feature engineering and modeling.
First, we'll need a target vector y, with all the teams in each season and whether or not
they made it to the Final Four.</p>
<p>Let's work off the seeds_and_names data frame, as those are all of our 996 participating colleges for each season.</p>
<div class="highlight"><pre><span></span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">))</span> <span class="c1"># zeros</span>

<span class="n">final_four_list</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">mm</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;final_four==1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">season</span><span class="p">,</span><span class="n">mm</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;final_four==1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">winning_team_id</span><span class="p">))</span><span class="o">+</span>
     <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">mm</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;final_four==1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">season</span><span class="p">,</span><span class="n">mm</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;final_four==1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">losing_team_id</span><span class="p">)))</span>

<span class="c1"># fill in teams with 1 if final_four team</span>
<span class="k">for</span> <span class="n">season</span><span class="p">,</span> <span class="n">team_id</span> <span class="ow">in</span> <span class="n">final_four_list</span><span class="p">:</span>
    <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span><span class="o">+=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">seed_and_names</span><span class="o">.</span><span class="n">season</span><span class="o">==</span><span class="n">season</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="o">.</span><span class="n">team_id</span><span class="o">==</span><span class="n">team_id</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">HTML</span><span class="p">(</span><span class="n">seed_and_names</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;final_four==1 &amp; season==2017&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>seed</th>
      <th>team_id</th>
      <th>team_name</th>
      <th>conference_code</th>
      <th>final_four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>23045</th>
      <td>2017</td>
      <td>7</td>
      <td>1376</td>
      <td>South Carolina</td>
      <td>sec</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>23292</th>
      <td>2017</td>
      <td>1</td>
      <td>1211</td>
      <td>Gonzaga</td>
      <td>wcc</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>23604</th>
      <td>2017</td>
      <td>3</td>
      <td>1332</td>
      <td>Oregon</td>
      <td>pac_twelve</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>23905</th>
      <td>2017</td>
      <td>1</td>
      <td>1314</td>
      <td>North Carolina</td>
      <td>acc</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>

<p>Great, now we have a final_four which will be our target y. Now we have to aggregate the stats for each
team, over all the 76636 games played.</p>
<p>e.g. for South Carolina, we now need the following aggregated stats for, points for, points against, etc.
Aggregating opponents stats so we have a sense of offensive and defensive ability because
defense wins champions!</p>
<ul>
<li>For each time a a specific team won, sum up all of their points</li>
<li>For each time a specific team lost, sum of all of their points</li>
<li>Sum up points from won and lost games</li>
<li>Repeat for all the variables of interest</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="n">stat</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
    <span class="n">df_w</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;winning_team_{stat}&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
    <span class="n">df_l</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;losing_team_{stat}&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
    <span class="n">df_for</span> <span class="o">=</span> <span class="n">df_w</span> <span class="o">+</span> <span class="n">df_l</span> 
    <span class="n">df_for</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">df_for_melt</span> <span class="o">=</span> <span class="n">df_for</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span>
    <span class="n">df_for_melt</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span> <span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span> <span class="n">df_for_melt</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;team_id&quot;</span><span class="p">])</span>

<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;score&#39;</span><span class="p">,</span><span class="s1">&#39;points_for&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;field_goals&#39;</span><span class="p">,</span><span class="s1">&#39;fg_for&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;field_goals_attempted&#39;</span><span class="p">,</span><span class="s1">&#39;fga_for&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;three_points&#39;</span><span class="p">,</span><span class="s1">&#39;3pm_for&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;three_points_attempted&#39;</span><span class="p">,</span><span class="s1">&#39;3pa_for&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;free_throws&#39;</span><span class="p">,</span><span class="s1">&#39;ft_for&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;free_throws_attempted&#39;</span><span class="p">,</span><span class="s1">&#39;fta_for&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;offensive_rebounds&#39;</span><span class="p">,</span><span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;defensive_rebounds&#39;</span><span class="p">,</span><span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;assists&#39;</span><span class="p">,</span><span class="s1">&#39;assists_for&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;steals&#39;</span><span class="p">,</span><span class="s1">&#39;steals_for&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;blocks&#39;</span><span class="p">,</span><span class="s1">&#39;blocks_for&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;turnovers&#39;</span><span class="p">,</span><span class="s1">&#39;turnovers_for&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;personal_fouls&#39;</span><span class="p">,</span><span class="s1">&#39;fouls_for&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="n">stat</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
    <span class="n">df_w</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;losing_team_{stat}&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
    <span class="n">df_l</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;winning_team_{stat}&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
    <span class="n">df_for</span> <span class="o">=</span> <span class="n">df_w</span> <span class="o">+</span> <span class="n">df_l</span> 
    <span class="n">df_for</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">df_for_melt</span> <span class="o">=</span> <span class="n">df_for</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span>
    <span class="n">df_for_melt</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span> <span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span> <span class="n">df_for_melt</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;team_id&quot;</span><span class="p">])</span>

<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;score&#39;</span><span class="p">,</span><span class="s1">&#39;points_against&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;field_goals&#39;</span><span class="p">,</span><span class="s1">&#39;fg_against&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;field_goals_attempted&#39;</span><span class="p">,</span><span class="s1">&#39;fga_against&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;three_points&#39;</span><span class="p">,</span><span class="s1">&#39;3pm_against&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;three_points_attempted&#39;</span><span class="p">,</span><span class="s1">&#39;3pa_against&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;free_throws&#39;</span><span class="p">,</span><span class="s1">&#39;ft_against&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;free_throws_attempted&#39;</span><span class="p">,</span><span class="s1">&#39;fta_against&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;offensive_rebounds&#39;</span><span class="p">,</span><span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;defensive_rebounds&#39;</span><span class="p">,</span><span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;assists&#39;</span><span class="p">,</span><span class="s1">&#39;assists_against&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;steals&#39;</span><span class="p">,</span><span class="s1">&#39;steals_against&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;blocks&#39;</span><span class="p">,</span><span class="s1">&#39;blocks_against&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;turnovers&#39;</span><span class="p">,</span><span class="s1">&#39;turnovers_against&#39;</span><span class="p">)</span>
<span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">stat_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">,</span><span class="s1">&#39;personal_fouls&#39;</span><span class="p">,</span><span class="s1">&#39;fouls_against&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">regular_season_total</span> <span class="o">=</span> <span class="n">seed_and_names</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">])</span>
</pre></div>


<hr>
<h2>Train Test Split</h2>
<ul>
<li>As always, let's train test split (80% / 20%). Given it's time series we will split on years.</li>
<li>There are 15 years of data, so we'll train on 12 years and test on the final 3 years (2015, 2016, 2017)</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">y_test</span> <span class="o">=</span> <span class="n">regular_season_total</span><span class="p">[</span><span class="n">regular_season_total</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">2015</span><span class="p">][</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">regular_season_total</span><span class="p">[</span><span class="n">regular_season_total</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">2015</span><span class="p">][</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>
</pre></div>


<p>Note, I ran into error with Wichita St. since they were undefeated, so we need avoid indexing issues by imputing with 0.</p>
<div class="highlight"><pre><span></span><span class="n">regular_season_total</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">regular_season_total</span><span class="p">[[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="s1">&#39;team_id&#39;</span><span class="p">,</span> <span class="s1">&#39;team_name&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code&#39;</span><span class="p">,</span> <span class="s1">&#39;points_for&#39;</span><span class="p">,</span> <span class="s1">&#39;points_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_against&#39;</span><span class="p">,</span>
                <span class="s1">&#39;3pm_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_for&#39;</span><span class="p">,</span>
                <span class="s1">&#39;3pa_against&#39;</span><span class="p">,</span> <span class="s1">&#39;ft_for&#39;</span><span class="p">,</span> <span class="s1">&#39;ft_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_against&#39;</span><span class="p">,</span>
                <span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">,</span> <span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">,</span>
                <span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">,</span> <span class="s1">&#39;assists_for&#39;</span><span class="p">,</span> <span class="s1">&#39;assists_against&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_for&#39;</span><span class="p">,</span>
                <span class="s1">&#39;steals_against&#39;</span><span class="p">,</span> <span class="s1">&#39;blocks_for&#39;</span><span class="p">,</span> <span class="s1">&#39;blocks_against&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_for&#39;</span><span class="p">,</span>
                <span class="s1">&#39;turnovers_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fouls_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fouls_against&#39;</span><span class="p">]]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;season&lt;2015&quot;</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;season&gt;=2015&quot;</span><span class="p">)</span>
</pre></div>


<hr>
<h2>Imputation</h2>
<ul>
<li>Data is pretty complete and in the right type which is great. We'll just need to create multi class labels, such that we can identify which conferences a team is in, as I suspect that some teams play in more competitive conferences than others.</li>
<li>Let's label qualitative variables.</li>
<li>We'll standardize after splitting.</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">mapper</span> <span class="o">=</span> <span class="n">DataFrameMapper</span><span class="p">([</span>
    <span class="p">([</span><span class="s1">&#39;season&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;seed&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;team_id&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;conference_code&#39;</span><span class="p">],</span><span class="n">LabelBinarizer</span><span class="p">()),</span>    
    <span class="p">([</span><span class="s1">&#39;points_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;points_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fg_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fg_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;3pm_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span> 
    <span class="p">([</span><span class="s1">&#39;3pm_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span> 
    <span class="p">([</span><span class="s1">&#39;fga_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fga_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;3pa_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span> 
    <span class="p">([</span><span class="s1">&#39;3pa_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;ft_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>  
    <span class="p">([</span><span class="s1">&#39;ft_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fta_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fta_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;assists_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;assists_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;steals_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;steals_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;blocks_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;blocks_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;turnovers_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;turnovers_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fouls_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fouls_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">)</span>
<span class="p">],</span><span class="n">df_out</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">Z_train</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">Z_test</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> 
<span class="c1"># Remember, you never want to fit because if you see something you never saw before (e.g. emoji)</span>
<span class="c1"># then it will be &#39;labelbinarized&#39;, when it fact it should be treated as something diff instead</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Fix shape problems</span>
<span class="c1"># list(zip(Z_train.columns,Z_test.columns)) # there are less conferences in 2015 -&gt; 2018</span>
<span class="c1"># mid_cont, pac_ten are in Z_train but not in Z_test</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">HTML</span><span class="p">(</span><span class="n">teams</span><span class="p">[</span><span class="n">teams</span><span class="p">[</span><span class="s2">&quot;conference_code&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;mid_cont&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;season&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
<span class="c1"># mid_cont only occured 2004-&gt;2007</span>
<span class="c1"># Chicago moved from mid_cont to gwc in 2010</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>team_id</th>
      <th>team_name</th>
      <th>conference_code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14628</th>
      <td>2004</td>
      <td>1147</td>
      <td>Centenary</td>
      <td>mid_cont</td>
    </tr>
    <tr>
      <th>14629</th>
      <td>2005</td>
      <td>1147</td>
      <td>Centenary</td>
      <td>mid_cont</td>
    </tr>
    <tr>
      <th>14630</th>
      <td>2006</td>
      <td>1147</td>
      <td>Centenary</td>
      <td>mid_cont</td>
    </tr>
    <tr>
      <th>14631</th>
      <td>2007</td>
      <td>1147</td>
      <td>Centenary</td>
      <td>mid_cont</td>
    </tr>
    <tr>
      <th>16279</th>
      <td>2003</td>
      <td>1152</td>
      <td>Chicago St</td>
      <td>mid_cont</td>
    </tr>
  </tbody>
</table>

<div class="highlight"><pre><span></span><span class="n">HTML</span><span class="p">(</span><span class="n">teams</span><span class="p">[</span><span class="n">teams</span><span class="p">[</span><span class="s2">&quot;conference_code&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;pac_ten&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;season&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
<span class="c1"># only occured 2003-&gt;2011;</span>
<span class="c1"># in 2012, Arizona played in pac_twelve</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>team_id</th>
      <th>team_name</th>
      <th>conference_code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3601</th>
      <td>2003</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3602</th>
      <td>2004</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3603</th>
      <td>2005</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3604</th>
      <td>2006</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3605</th>
      <td>2007</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3606</th>
      <td>2008</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3607</th>
      <td>2009</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3608</th>
      <td>2010</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3609</th>
      <td>2011</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
  </tbody>
</table>

<div class="highlight"><pre><span></span><span class="c1"># let&#39;s be more verbose and label mid_cont in pac_ten columns in test, with 0 so they&#39;re the same shape</span>
<span class="n">Z_test</span><span class="p">[</span><span class="s2">&quot;conference_code_pac_ten&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Z_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">Z_test</span><span class="p">[</span><span class="s2">&quot;conference_code_mid_cont&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Z_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)))</span>

<span class="c1"># Showing up as NaN -&gt; need to make zero</span>
<span class="n">Z_test</span><span class="p">[</span><span class="s2">&quot;conference_code_pac_ten&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Z_test</span><span class="p">[</span><span class="s2">&quot;conference_code_mid_cont&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<hr>
<h2>Establish Benchmarks</h2>
<p>Let's quickly spin up a naive baseline/benchmark model &amp; naive out the door. Then, in subsequent steps, we can feature engineering and model to improve our score!</p>
<p>From FiveThirtyEight, 1 seeds only had a 35%-52% of reaching the final four.</p>
<p><img src="./images/ncaa.png"  width="620" height="120"></p>
<p>Let's see how how our naive model's prediction fared.</p>
<div class="highlight"><pre><span></span><span class="c1"># Baseline logistic </span>

<span class="c1"># Step 1: Instantiate our model.</span>
<span class="n">logreg_baseline</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 2: Fit our model.</span>
<span class="n">logreg_baseline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Z_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Step 3 (part 1): Generate prediction values</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Number of teams making it to final four: {sum(logreg_baseline.predict(Z_train))}&#39;</span><span class="p">)</span>

<span class="c1"># Step 3 (part 2): Generate predictions/probabilities</span>
<span class="n">logreg_baseline</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">Z_train</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Step 4: Score the model:</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg train accuracy: {logreg_baseline.score(Z_train,y_train)}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg test accuracy: {logreg_baseline.score(Z_test,y_test)}&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nb">Number</span> <span class="k">of</span> <span class="n">teams</span> <span class="n">making</span> <span class="n">it</span> <span class="k">to</span> <span class="k">final</span> <span class="n">four</span><span class="p">:</span> <span class="mi">18</span><span class="p">.</span><span class="mi">0</span>
 <span class="n">Logreg</span> <span class="n">train</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">9444444444444444</span>
 <span class="n">Logreg</span> <span class="n">test</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">9558823529411765</span>
</pre></div>


<hr>
<h3>Imbalanced Classes</h3>
<ul>
<li>Accuracy of 94% looks good right? However, we have imbalanced classes.</li>
<li>Over 15 years, 60 final four teams, 936 non-final four, 996 total.</li>
<li>1-60/996 = 94%</li>
<li>Any naive model would be equally as good as this baseline logistic regression, by simply taking the accuracy mean.</li>
<li>This is a misleading accuracy as it's overestimated. Let's quickly spin up a AUC score to score the accuracy of this logistic classifier, and measure this imbalance.</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">logreg_baseline</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">Z_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="mi">0</span><span class="p">.</span><span class="mi">7300347222222222</span>
</pre></div>


<p>Since 73% &gt; 50%, the AUC tells us that this classifier is better than a no better than a 'no information' classifer. However there may be room for improvement. </p>
<p>To get a better evaluation of our baseline model, let's better represent the minority class (final four)
with more signal, via over sampling, i.e. randomly sampling with replacement from available samples. I prefer this over SMOTE (Synthetic) because I would like to keep track of the number of games played, and to also keep the years and seeds an int.</p>
<div class="highlight"><pre><span></span><span class="c1"># I added final_four to this mapper so I can split after, preserve order rather than randomly splitting</span>
<span class="n">mapper_all</span> <span class="o">=</span> <span class="n">DataFrameMapper</span><span class="p">([</span>
    <span class="p">([</span><span class="s1">&#39;season&#39;</span><span class="p">],</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;seed&#39;</span><span class="p">],</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;team_id&#39;</span><span class="p">],</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;conference_code&#39;</span><span class="p">],</span> <span class="n">LabelBinarizer</span><span class="p">()),</span>    
    <span class="p">([</span><span class="s1">&#39;final_four&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;points_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;points_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fg_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fg_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;3pm_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span> 
    <span class="p">([</span><span class="s1">&#39;3pm_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span> 
    <span class="p">([</span><span class="s1">&#39;fga_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fga_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;3pa_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span> 
    <span class="p">([</span><span class="s1">&#39;3pa_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;ft_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>  
    <span class="p">([</span><span class="s1">&#39;ft_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fta_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fta_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;assists_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;assists_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;steals_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;steals_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;blocks_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;blocks_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;turnovers_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;turnovers_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fouls_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fouls_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">)</span>
<span class="p">],</span><span class="n">df_out</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">mapper_all</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">regular_season_total</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="s1">&#39;team_id&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_a_sun&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_a_ten&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_aac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_acc&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_aec&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_big_east&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_big_sky&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_big_south&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_big_ten&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_big_twelve&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_big_west&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_caa&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_cusa&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_horizon&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_ivy&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_maac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_mac&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_meac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_mid_cont&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_mvc&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_mwc&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_nec&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_ovc&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_pac_ten&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_pac_twelve&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_patriot&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_sec&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_southern&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_southland&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_summit&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_sun_belt&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_swac&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_wac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_wcc&#39;</span><span class="p">,</span>
       <span class="s1">&#39;points_for&#39;</span><span class="p">,</span> <span class="s1">&#39;points_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;3pm_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;ft_for&#39;</span><span class="p">,</span> <span class="s1">&#39;ft_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_against&#39;</span><span class="p">,</span> <span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;assists_for&#39;</span><span class="p">,</span> <span class="s1">&#39;assists_against&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_for&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;blocks_for&#39;</span><span class="p">,</span> <span class="s1">&#39;blocks_against&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_for&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;fouls_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fouls_against&#39;</span><span class="p">]]</span>

<span class="n">random_sampler</span> <span class="o">=</span> <span class="n">RandomOverSampler</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">X_resampled</span><span class="p">,</span> <span class="n">y_resampled</span> <span class="o">=</span> <span class="n">random_sampler</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">X_resampled</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> 
<span class="k">print</span><span class="p">(</span><span class="n">y_resampled</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># there are 936 final four rows and 936 non-final four</span>
<span class="k">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">y_resampled</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1872</span><span class="p">,</span> <span class="mi">65</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1872</span><span class="p">,)</span>
<span class="mi">936</span><span class="p">.</span><span class="mi">0</span>
</pre></div>


<p>Let's recalculate accuracy and AUC</p>
<div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_resampled</span><span class="p">),</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_resampled</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;final_four&#39;</span><span class="p">,</span><span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="s1">&#39;team_id&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_a_sun&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_a_ten&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_aac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_acc&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_aec&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_big_east&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_big_sky&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_big_south&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_big_ten&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_big_twelve&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_big_west&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_caa&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_cusa&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_horizon&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_ivy&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_maac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_mac&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_meac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_mid_cont&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_mvc&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_mwc&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_nec&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_ovc&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_pac_ten&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_pac_twelve&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_patriot&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_sec&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_southern&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_southland&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_summit&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_sun_belt&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_swac&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_wac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_wcc&#39;</span><span class="p">,</span> <span class="s1">&#39;points_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;points_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;fga_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_against&#39;</span><span class="p">,</span> <span class="s1">&#39;ft_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;ft_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_against&#39;</span><span class="p">,</span> <span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;assists_for&#39;</span><span class="p">,</span> <span class="s1">&#39;assists_against&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_for&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;blocks_for&#39;</span><span class="p">,</span> <span class="s1">&#39;blocks_against&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_for&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;fouls_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fouls_against&#39;</span><span class="p">]</span>

<span class="c1"># Let&#39;s split on the years again</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">2015</span><span class="p">][</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">2015</span><span class="p">][</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>

<span class="c1"># 379/1872 so about 20%/80% split which is fine, I prefer the interpretability and preserve meaning.</span>
<span class="c1"># We are using 2003 -&gt; 2014 data to predict and test 2015, 2016, 2017.</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;season&quot;</span><span class="p">:</span><span class="s2">&quot;fouls_against&quot;</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">2015</span><span class="p">]</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">2015</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; X_train shape {X_train.shape}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; y_train shape {y_train.shape}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; X_test shape {X_test.shape}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; y_test shape {y_test.shape}&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span> <span class="n">X_train</span> <span class="n">shape</span> <span class="p">(</span><span class="mi">1493</span><span class="p">,</span> <span class="mi">65</span><span class="p">)</span>
 <span class="n">y_train</span> <span class="n">shape</span> <span class="p">(</span><span class="mi">1493</span><span class="p">,)</span>


 <span class="n">X_test</span> <span class="n">shape</span> <span class="p">(</span><span class="mi">379</span><span class="p">,</span> <span class="mi">65</span><span class="p">)</span>
 <span class="n">y_test</span> <span class="n">shape</span> <span class="p">(</span><span class="mi">379</span><span class="p">,)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Baseline logistic with balanced classes</span>

<span class="c1"># Step 1: Instantiate our model.</span>
<span class="n">logreg_baseline</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 2: Fit our model.</span>
<span class="n">logreg_baseline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Step 3 (part 1): Generate prediction values</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Number of teams making it to final four: {sum(logreg_baseline.predict(X_train))}&#39;</span><span class="p">)</span>

<span class="c1"># Step 3 (part 2): Generate predictions/probabilities</span>
<span class="n">logreg_baseline</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Step 4: Score the model:</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg train accuracy: {cross_val_score(logreg_baseline, X_train, y_train, cv=5).mean()}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg test accuracy: {cross_val_score(logreg_baseline, X_test, y_test, cv=5).mean()}&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nb">Number</span> <span class="k">of</span> <span class="n">teams</span> <span class="n">making</span> <span class="n">it</span> <span class="k">to</span> <span class="k">final</span> <span class="n">four</span><span class="p">:</span> <span class="mi">858</span><span class="p">.</span><span class="mi">0</span>
 <span class="n">Logreg</span> <span class="n">train</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8961679222548786</span>
 <span class="n">Logreg</span> <span class="n">test</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">9473593073593072</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">logreg_baseline</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="mi">0</span><span class="p">.</span><span class="mi">7704155525846702</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; seed coeff {np.exp(-0.562391)}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; acc coeff {np.exp(-1.32)}&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span> <span class="n">seed</span> <span class="n">coeff</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5698449344437365</span>
 <span class="n">acc</span> <span class="n">coeff</span> <span class="mi">0</span><span class="p">.</span><span class="mi">26713530196585034</span>
</pre></div>


<p>The seed is very important.
Remember, need to take exponential. If your seed increases by 1, your likelihood of reaching final four
is 0.57x less. The individual team stats are less important, as I suspect the seed already captures a lot of that information. Season and team_id obviously do not matter as shown by 0 coefficient.</p>
<p>And what conference you play in matters (acc, big_twelve or big_ten). If you play in acc, your likelihood of reaching final four is 0.26x less, this is probably explaining for the teams who are not top tier.</p>
<div class="highlight"><pre><span></span><span class="n">HTML</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">logreg_baseline</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])))</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>season</td>
      <td>-0.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>seed</td>
      <td>-0.56</td>
    </tr>
    <tr>
      <th>2</th>
      <td>team_id</td>
      <td>-0.00</td>
    </tr>
  </tbody>
</table>

<p>The AUC scores are more representative of the model's true performance. This basic logistic model was able to
be accurate 90% of the time with training data and 95% with test data. Therefore, it's a good benchmark, with no strong indication of over-fitting, but let's try to improve through feature engineering (advanced basketball metrics!) and regularization.</p>
<p>Notice how the AUC score has improved now. With this model (trained on balanced classes), we are materially better than a 'no information' classifier. It's closer to 1 so it does not display signals of imbalanced classes, nor overwhelming amount of false positives vs false negatives. We'll revisit this later in model evaluation.</p>
<hr>
<h1>Exploratory Data Analysis</h1>
<p>Let us perform EDA to better understand our data. </p>
<h2>Summary Statistics</h2>
<h3>Correlation and Heatmap</h3>
<ul>
<li>Final_four is negatively correlated to seed (higher seed -&gt; less likely to be in final four)</li>
<li>
<p>Final_four is positively correlated to fg_for (higher fg_for -&gt; more likely to be in final four)</p>
<ul>
<li>Similar situation for blocks, assists, rebounds, points scored</li>
</ul>
</li>
<li>
<p>Some of these independent variables are highly correlated, so I may not want to use all of them to reduce over-fitting. </p>
<ul>
<li>For example, points_for is related with points against, so I may want to combine those in a points differential variable, and offensive efficiency will combine (assists_for, fg_for)</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">quant</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;final_four&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="s1">&#39;team_id&#39;</span><span class="p">,</span> <span class="s1">&#39;points_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;points_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;fga_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_against&#39;</span><span class="p">,</span> <span class="s1">&#39;ft_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;ft_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_against&#39;</span><span class="p">,</span> <span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;assists_for&#39;</span><span class="p">,</span> <span class="s1">&#39;assists_against&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_for&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;blocks_for&#39;</span><span class="p">,</span> <span class="s1">&#39;blocks_against&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_for&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;fouls_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fouls_against&#39;</span><span class="p">]]</span>

<span class="n">stats</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;points_for&#39;</span><span class="p">,</span><span class="s1">&#39;points_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;fga_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_against&#39;</span><span class="p">,</span> <span class="s1">&#39;ft_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;ft_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_against&#39;</span><span class="p">,</span> <span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;assists_for&#39;</span><span class="p">,</span> <span class="s1">&#39;assists_against&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_for&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;blocks_for&#39;</span><span class="p">,</span> <span class="s1">&#39;blocks_against&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_for&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;fouls_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fouls_against&#39;</span><span class="p">]]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">with</span> <span class="n">sns</span><span class="o">.</span><span class="n">axes_style</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">yticklabels</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="images/ncaa_66_0.png"></p>
<div class="highlight"><pre><span></span><span class="n">HTML</span><span class="p">(</span><span class="n">quant</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s1">&#39;table table-responsive table-striped&#39;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>final_four</th>
      <th>season</th>
      <th>seed</th>
      <th>team_id</th>
      <th>points_for</th>
      <th>points_against</th>
      <th>fg_for</th>
      <th>fg_against</th>
      <th>3pm_for</th>
      <th>3pm_against</th>
      <th>fga_for</th>
      <th>fga_against</th>
      <th>3pa_for</th>
      <th>3pa_against</th>
      <th>ft_for</th>
      <th>ft_against</th>
      <th>fta_for</th>
      <th>fta_against</th>
      <th>off_rebounds_for</th>
      <th>off_rebounds_against</th>
      <th>def_rebounds_for</th>
      <th>def_rebounds_against</th>
      <th>assists_for</th>
      <th>assists_against</th>
      <th>steals_for</th>
      <th>steals_against</th>
      <th>blocks_for</th>
      <th>blocks_against</th>
      <th>turnovers_for</th>
      <th>turnovers_against</th>
      <th>fouls_for</th>
      <th>fouls_against</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
      <td>1872.00</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.50</td>
      <td>2009.95</td>
      <td>6.05</td>
      <td>1290.26</td>
      <td>2370.96</td>
      <td>2049.25</td>
      <td>836.08</td>
      <td>729.79</td>
      <td>213.76</td>
      <td>192.89</td>
      <td>1802.26</td>
      <td>1780.15</td>
      <td>588.58</td>
      <td>585.63</td>
      <td>485.04</td>
      <td>396.78</td>
      <td>686.40</td>
      <td>577.32</td>
      <td>379.41</td>
      <td>351.31</td>
      <td>788.69</td>
      <td>688.99</td>
      <td>469.75</td>
      <td>376.67</td>
      <td>224.75</td>
      <td>193.06</td>
      <td>133.78</td>
      <td>101.09</td>
      <td>403.02</td>
      <td>446.56</td>
      <td>553.43</td>
      <td>605.75</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.50</td>
      <td>4.34</td>
      <td>4.79</td>
      <td>99.57</td>
      <td>310.72</td>
      <td>254.79</td>
      <td>115.35</td>
      <td>95.10</td>
      <td>47.18</td>
      <td>35.78</td>
      <td>233.19</td>
      <td>229.30</td>
      <td>116.29</td>
      <td>103.06</td>
      <td>81.73</td>
      <td>74.40</td>
      <td>111.37</td>
      <td>106.74</td>
      <td>73.81</td>
      <td>60.89</td>
      <td>109.08</td>
      <td>94.69</td>
      <td>78.42</td>
      <td>58.24</td>
      <td>49.50</td>
      <td>34.69</td>
      <td>50.44</td>
      <td>23.60</td>
      <td>63.21</td>
      <td>76.71</td>
      <td>79.72</td>
      <td>78.79</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.00</td>
      <td>2003.00</td>
      <td>1.00</td>
      <td>1102.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.00</td>
      <td>2006.00</td>
      <td>2.00</td>
      <td>1210.00</td>
      <td>2226.00</td>
      <td>1957.00</td>
      <td>779.00</td>
      <td>695.00</td>
      <td>184.00</td>
      <td>171.00</td>
      <td>1708.50</td>
      <td>1680.00</td>
      <td>525.00</td>
      <td>534.00</td>
      <td>446.00</td>
      <td>357.75</td>
      <td>637.00</td>
      <td>518.75</td>
      <td>337.00</td>
      <td>319.00</td>
      <td>733.00</td>
      <td>646.00</td>
      <td>428.00</td>
      <td>347.75</td>
      <td>191.00</td>
      <td>173.00</td>
      <td>101.00</td>
      <td>87.00</td>
      <td>376.00</td>
      <td>404.00</td>
      <td>522.00</td>
      <td>574.00</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.50</td>
      <td>2010.00</td>
      <td>4.00</td>
      <td>1277.00</td>
      <td>2403.00</td>
      <td>2061.00</td>
      <td>838.00</td>
      <td>733.00</td>
      <td>212.00</td>
      <td>192.00</td>
      <td>1824.00</td>
      <td>1802.00</td>
      <td>595.00</td>
      <td>588.00</td>
      <td>488.00</td>
      <td>394.50</td>
      <td>698.00</td>
      <td>582.00</td>
      <td>376.00</td>
      <td>355.00</td>
      <td>798.00</td>
      <td>698.00</td>
      <td>467.00</td>
      <td>375.00</td>
      <td>224.00</td>
      <td>194.00</td>
      <td>123.00</td>
      <td>102.00</td>
      <td>398.00</td>
      <td>444.00</td>
      <td>561.00</td>
      <td>615.00</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.00</td>
      <td>2014.00</td>
      <td>10.00</td>
      <td>1386.00</td>
      <td>2552.00</td>
      <td>2164.00</td>
      <td>901.00</td>
      <td>776.00</td>
      <td>243.00</td>
      <td>213.00</td>
      <td>1916.00</td>
      <td>1903.00</td>
      <td>662.00</td>
      <td>646.00</td>
      <td>525.00</td>
      <td>442.00</td>
      <td>746.00</td>
      <td>641.00</td>
      <td>425.00</td>
      <td>386.25</td>
      <td>851.00</td>
      <td>742.00</td>
      <td>512.00</td>
      <td>406.00</td>
      <td>252.00</td>
      <td>211.00</td>
      <td>159.25</td>
      <td>114.00</td>
      <td>440.00</td>
      <td>493.00</td>
      <td>599.00</td>
      <td>647.00</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.00</td>
      <td>2017.00</td>
      <td>16.00</td>
      <td>1463.00</td>
      <td>3016.00</td>
      <td>2657.00</td>
      <td>1113.00</td>
      <td>999.00</td>
      <td>342.00</td>
      <td>335.00</td>
      <td>2245.00</td>
      <td>2248.00</td>
      <td>923.00</td>
      <td>899.00</td>
      <td>696.00</td>
      <td>648.00</td>
      <td>1020.00</td>
      <td>921.00</td>
      <td>555.00</td>
      <td>510.00</td>
      <td>1021.00</td>
      <td>956.00</td>
      <td>709.00</td>
      <td>564.00</td>
      <td>402.00</td>
      <td>291.00</td>
      <td>299.00</td>
      <td>179.00</td>
      <td>584.00</td>
      <td>695.00</td>
      <td>795.00</td>
      <td>795.00</td>
    </tr>
  </tbody>
</table>

<p>While the team's season statistics are useful, it may be more predictive to understand a team's performance on a per game basis, to understand how it's winning or losing its games.</p>
<p>The main categorical variable is conferences. It appears to also be predictive from the baseline, representing the strength of the conference. Some conferences are generally very strong and play stronger competition than others.
<ul>
<li> big_ten (Michigan State, Purdue, Michigan) </li>
<li> big_twelve (Texas Tech, Kansas State) </li>
<li> acc (Duke, UNC, Virgnia) </li>
</ul></p>
<p>See that big_east, acc, big_ten, sec, big_twelve all have 5+ teams that have made it to the final four. These are the conferences with the best teams.</p>
<div class="highlight"><pre><span></span><span class="n">HTML</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">regular_season_total</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;conference_code&quot;</span><span class="p">)[</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;final_four&quot;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s1">&#39;table table-responsive table-striped&#39;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>final_four</th>
    </tr>
    <tr>
      <th>conference_code</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>big_east</th>
      <td>11.00</td>
    </tr>
    <tr>
      <th>acc</th>
      <td>10.00</td>
    </tr>
    <tr>
      <th>big_ten</th>
      <td>10.00</td>
    </tr>
    <tr>
      <th>sec</th>
      <td>9.00</td>
    </tr>
    <tr>
      <th>big_twelve</th>
      <td>6.00</td>
    </tr>
  </tbody>
</table>

<p>Some other observations include: 
* No seeds greater than 11 have made it to final four
* Teams which make the final four, in the regular season score more, make more FG, give up less FTs, rebound more, block more, foul less, ... all the attributes of a great basketball team</p>
<hr>
<h1>Feature Engineering</h1>
<h2>'Standardize' features</h2>
<p>Let's keep the stat metrics on the same scale, on a per game basis rather than standardizing to keep it interpretable. First we need to count the number of games for each team.</p>
<div class="highlight"><pre><span></span><span class="n">regular</span><span class="p">[</span><span class="s2">&quot;game_won&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">regular</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df_gw</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;winning_team_id&quot;</span><span class="p">,</span><span class="s2">&quot;game_won&quot;</span><span class="p">]]</span>
<span class="n">df_gw</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;game_won&quot;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">regular</span><span class="p">[</span><span class="s2">&quot;game_lost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">regular</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df_gl</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;losing_team_id&quot;</span><span class="p">,</span><span class="s2">&quot;game_lost&quot;</span><span class="p">]]</span>
<span class="n">df_gl</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;game_lost&quot;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">df_gl</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;team_id&#39;</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">df_gw</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;team_id&#39;</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;game_total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;game_won&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;game_lost&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Effective gf </span>
<span class="c1"># This statistic adjusts for the fact that a 3-point field goal is worth one more point than a 2-point field goal.</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;efg%&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;fg_for&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;3pm_for&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;fga_for&quot;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;points_for&#39;</span><span class="p">:</span><span class="s1">&#39;fouls_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;points_for&#39;</span><span class="p">,</span> <span class="s1">&#39;points_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_against&#39;</span><span class="p">,</span>
 <span class="s1">&#39;fga_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_against&#39;</span><span class="p">,</span> <span class="s1">&#39;ft_for&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ft_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_against&#39;</span><span class="p">,</span> <span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">,</span>
   <span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">,</span>
   <span class="s1">&#39;assists_for&#39;</span><span class="p">,</span> <span class="s1">&#39;assists_against&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_for&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_against&#39;</span><span class="p">,</span>
   <span class="s1">&#39;blocks_for&#39;</span><span class="p">,</span> <span class="s1">&#39;blocks_against&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_for&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_against&#39;</span><span class="p">,</span>
   <span class="s1">&#39;fouls_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fouls_against&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">game_total</span><span class="p">)</span>
</pre></div>


<h2>Transform and add new features</h2>
<p>Let's use some advanced metrics from the NBA. 
Note, opponent % are kept as to gauge defense as well.</p>
<div class="highlight"><pre><span></span><span class="c1"># Now, instead of games_won and games_lost, let&#39;s combine this into win_%</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;win_%&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;game_won&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;game_total&quot;</span><span class="p">]</span>

<span class="c1"># +/- point differential aka margin of victory</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;margin_of_victory&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;points_for&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;points_against&quot;</span><span class="p">]</span>

<span class="c1"># Assist to turnover ratio: this measures your ability to care of possessions and pass the ball, as a team.</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;ast_to_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;assists_for&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;turnovers_for&quot;</span><span class="p">]</span>

<span class="c1"># Let&#39;s convert field goals, threes and fts into %. Will reduce collinearity and also simplify interpretation.</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;fg%_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fg_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;fga_for&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;fg%_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fg_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;fga_against&#39;</span><span class="p">]</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;3p%_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;3pm_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;3pa_for&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;3p%_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;3pm_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;3pa_against&#39;</span><span class="p">]</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ft%_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ft_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;fta_for&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ft%_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ft_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;fta_against&#39;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># drop games won, lost, its redundant with win_%</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;game_won&quot;</span><span class="p">,</span><span class="s2">&quot;game_lost&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Some games have no data, probably from sampling these teams don&#39;t exist. Let&#39;s just drop for now since I&#39;m getting NaN.</span>
<span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./data/df.csv&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span> <span class="c1"># 1856 observations</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1856</span><span class="p">,</span> <span class="mi">77</span><span class="p">)</span>
</pre></div>


<p>I will keep the original features and use regularization methods in the next section.</p>
<hr>
<h1>Modelling</h1>
<h2>Logistic Regression with Regularization</h2>
<h3>L1: Lasso</h3>
<p>I prefer Lasso as a shrinkage method, to narrow down on the most important features, since our baseline model was very accurate already. </p>
<div class="highlight"><pre><span></span><span class="n">y_test</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">2015</span><span class="p">][</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">2015</span><span class="p">][</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;season&lt;2015&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;season&quot;</span><span class="p">:</span><span class="s2">&quot;ft%_against&quot;</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;season&gt;=2015&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;season&quot;</span><span class="p">:</span><span class="s2">&quot;ft%_against&quot;</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1">#80%</span>
<span class="k">print</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1">#20%</span>

<span class="c1"># Instantiate Model</span>
<span class="n">logreg_lasso_1</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Fit model.</span>
<span class="n">logreg_lasso_1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Logistic Regression Intercept: {logreg_lasso_1.intercept_}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Logistic Regression Coefficient: {logreg_lasso_1.coef_}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Generate prediction values</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Number of teams making it to final four:{sum(logreg_lasso_1.predict(X_train))}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Generate predictions/probabilities</span>
<span class="k">print</span><span class="p">(</span><span class="n">logreg_lasso_1</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1492</span><span class="p">,</span> <span class="mi">76</span><span class="p">)</span>
<span class="p">(</span><span class="mi">364</span><span class="p">,</span> <span class="mi">76</span><span class="p">)</span>
<span class="n">Logistic</span> <span class="n">Regression</span> <span class="n">Intercept</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">.]</span>
<span class="n">Logistic</span> <span class="n">Regression</span> <span class="n">Coefficient</span><span class="p">:</span> <span class="p">[[</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">0012153</span>  <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">6837633</span>   <span class="mi">0</span><span class="p">.</span><span class="mi">00072333</span>  <span class="mi">0</span><span class="p">.</span>         <span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="mi">44191693</span>  <span class="mi">2</span><span class="p">.</span><span class="mi">48408599</span>
  <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">964152</span>    <span class="mi">0</span><span class="p">.</span>         <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">31075531</span>  <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span><span class="mi">80899047</span>
  <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">47521544</span>  <span class="mi">0</span><span class="p">.</span>          <span class="mi">6</span><span class="p">.</span><span class="mi">28137961</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">93520549</span>  <span class="mi">5</span><span class="p">.</span><span class="mi">1251736</span>   <span class="mi">0</span><span class="p">.</span>
   <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>          <span class="mi">1</span><span class="p">.</span><span class="mi">91588091</span> <span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="mi">56345391</span>
   <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>         <span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="mi">5507449</span>   <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span><span class="mi">24535897</span>
   <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>
  <span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="mi">40287112</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">09635222</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">03212444</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">15745544</span>  <span class="mi">0</span><span class="p">.</span>         <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">68313285</span>
   <span class="mi">1</span><span class="p">.</span><span class="mi">38608677</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">33650906</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">20264111</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">48025645</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">49238313</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">19572923</span>
  <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">4448577</span>  <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">24921486</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">67154919</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">40774297</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">13740773</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">16521916</span>
   <span class="mi">0</span><span class="p">.</span><span class="mi">01779028</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">45970706</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">19248742</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">21530272</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">02207059</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">01640808</span>
   <span class="mi">0</span><span class="p">.</span><span class="mi">23174252</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">26819881</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">35574917</span>  <span class="mi">0</span><span class="p">.</span>         <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">47109025</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">24791855</span>
   <span class="mi">0</span><span class="p">.</span>         <span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="mi">02168244</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">44660712</span>  <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>
   <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>          <span class="mi">0</span><span class="p">.</span>        <span class="p">]]</span>


<span class="nb">Number</span> <span class="k">of</span> <span class="n">teams</span> <span class="n">making</span> <span class="n">it</span> <span class="k">to</span> <span class="k">final</span> <span class="n">four</span><span class="p">:</span><span class="mi">832</span><span class="p">.</span><span class="mi">0</span>


<span class="p">[</span><span class="mi">0</span><span class="p">.</span><span class="mi">45132789</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8439776</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">88002624</span> <span class="p">...</span> <span class="mi">0</span><span class="p">.</span><span class="mi">97316549</span> <span class="mi">0</span><span class="p">.</span><span class="mi">7337679</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">79253303</span><span class="p">]</span>
</pre></div>


<h3>Interpretation of Coefficients</h3>
<div class="highlight"><pre><span></span><span class="n">lasso_coef</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">logreg_lasso_1</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])))</span>
<span class="n">lasso_coef</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span><span class="s2">&quot;coef&quot;</span><span class="p">]</span>
<span class="n">lasso_coef</span><span class="p">[</span><span class="s2">&quot;coef_abs&quot;</span><span class="p">]</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">lasso_coef</span><span class="p">[</span><span class="s2">&quot;coef&quot;</span><span class="p">])</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">lasso_coef</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;coef_abs&quot;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">25</span><span class="p">]</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s1">&#39;table table-responsive table-striped&#39;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>variable</th>
      <th>coef</th>
      <th>coef_abs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14</th>
      <td>conference_code_caa</td>
      <td>6.28</td>
      <td>6.28</td>
    </tr>
    <tr>
      <th>16</th>
      <td>conference_code_horizon</td>
      <td>5.13</td>
      <td>5.13</td>
    </tr>
    <tr>
      <th>36</th>
      <td>conference_code_wcc</td>
      <td>-3.40</td>
      <td>3.40</td>
    </tr>
    <tr>
      <th>23</th>
      <td>conference_code_mwc</td>
      <td>-2.56</td>
      <td>2.56</td>
    </tr>
    <tr>
      <th>27</th>
      <td>conference_code_pac_twelve</td>
      <td>-2.55</td>
      <td>2.55</td>
    </tr>
    <tr>
      <th>5</th>
      <td>conference_code_aac</td>
      <td>2.48</td>
      <td>2.48</td>
    </tr>
    <tr>
      <th>4</th>
      <td>conference_code_a_ten</td>
      <td>-2.44</td>
      <td>2.44</td>
    </tr>
    <tr>
      <th>67</th>
      <td>win_%</td>
      <td>-2.02</td>
      <td>2.02</td>
    </tr>
    <tr>
      <th>22</th>
      <td>conference_code_mvc</td>
      <td>1.92</td>
      <td>1.92</td>
    </tr>
    <tr>
      <th>41</th>
      <td>3pm_for</td>
      <td>-1.68</td>
      <td>1.68</td>
    </tr>
    <tr>
      <th>12</th>
      <td>conference_code_big_twelve</td>
      <td>-1.48</td>
      <td>1.48</td>
    </tr>
    <tr>
      <th>42</th>
      <td>3pm_against</td>
      <td>1.39</td>
      <td>1.39</td>
    </tr>
    <tr>
      <th>6</th>
      <td>conference_code_acc</td>
      <td>-0.96</td>
      <td>0.96</td>
    </tr>
    <tr>
      <th>15</th>
      <td>conference_code_cusa</td>
      <td>0.94</td>
      <td>0.94</td>
    </tr>
    <tr>
      <th>11</th>
      <td>conference_code_big_ten</td>
      <td>0.81</td>
      <td>0.81</td>
    </tr>
    <tr>
      <th>1</th>
      <td>seed</td>
      <td>-0.68</td>
      <td>0.68</td>
    </tr>
    <tr>
      <th>50</th>
      <td>fta_against</td>
      <td>0.67</td>
      <td>0.67</td>
    </tr>
    <tr>
      <th>46</th>
      <td>3pa_against</td>
      <td>-0.49</td>
      <td>0.49</td>
    </tr>
    <tr>
      <th>45</th>
      <td>3pa_for</td>
      <td>0.48</td>
      <td>0.48</td>
    </tr>
    <tr>
      <th>64</th>
      <td>fouls_against</td>
      <td>-0.47</td>
      <td>0.47</td>
    </tr>
    <tr>
      <th>55</th>
      <td>assists_for</td>
      <td>-0.46</td>
      <td>0.46</td>
    </tr>
    <tr>
      <th>68</th>
      <td>margin_of_victory</td>
      <td>0.45</td>
      <td>0.45</td>
    </tr>
    <tr>
      <th>48</th>
      <td>ft_against</td>
      <td>-0.44</td>
      <td>0.44</td>
    </tr>
    <tr>
      <th>51</th>
      <td>off_rebounds_for</td>
      <td>0.41</td>
      <td>0.41</td>
    </tr>
    <tr>
      <th>62</th>
      <td>turnovers_against</td>
      <td>-0.36</td>
      <td>0.36</td>
    </tr>
  </tbody>
</table>

<ul>
<li>
<p>Outside of conferences, win_% is the most important predictor. Although it's strange to see that it has a negative sign, this is probably the case because schools that make to to the final four actually have lower win % than schools who do not make it to the final four because they face tougher competition (57% avg vs 72% avg). This supports the argument that which conference you play for is very important in predictive power. </p>
</li>
<li>
<p>Again, your strongest conferences, are the big_twelve, acc, big_ten. If you play in acc, your likelihood of reaching final four is very low, because you will likely be dominated by the top tier schools in those conferences. </p>
</li>
<li>
<p>In terms of regular season states, 3PM for and against is important, as the game continues to move shooting more threes, as it's been proven to be an effective strategy. </p>
</li>
<li>
<p>Lastly, seed is not to be overlooked as it's a good composite score for a team's strength, capturing a lot of regular season performance. As your seed increases by 1, your likelihood of reaching final four is 0.50x less. This makes sense, as a 3 seed only has a ~12.5% (0.5^3) of making to final four! This is consistent with FiveThirtyEight's forecasts. Purdue, Houston, &amp; Texas Tech had 10-14% of making it to the Final four.</p>
</li>
<li>
<p>Similar to the NBA, margin of victory is a predictive variable though with a positive correlation. In the NBA, there is more parity since each team plays one another at least twice in a season, so individual team stats are more important than seed &amp; conference.</p>
</li>
</ul>
<hr>
<h2>Model Evaluation</h2>
<div class="highlight"><pre><span></span><span class="c1"># Score the model - accuracy</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg train accuracy: {cross_val_score(logreg_lasso_1, X_train, y_train, cv=5).mean()}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg test accuracy: {cross_val_score(logreg_lasso_1, X_test, y_test, cv=5).mean()}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Area under the curve</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Area under the curve: {roc_auc_score(y_test, logreg_lasso_1.predict_proba(X_test)[:,1])}&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span> <span class="n">Logreg</span> <span class="n">train</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8981365433947868</span>


 <span class="n">Logreg</span> <span class="n">test</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">9203453453453454</span>


 <span class="n">Area</span> <span class="k">under</span> <span class="n">the</span> <span class="n">curve</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8046269379844961</span>
</pre></div>


<table class="table">
<thead class="table-responsive table-striped">
<tr>
<th>Metric</th>
<th>Baseline</th>
<th>Logistic Regression, Lasso = 1</th>
</tr>
<tbody>
<tr>
<td>Train Accuracy</td>
<td>94%</td>
<td>90%</td>
</tr>
<tr>
<td>Test Accuracy</td>
<td>96%</td>
<td>92%</td>
</tr>
<tr>
<td>Area under the curve</td>
<td>77%</td>
<td>80%</td>
</tr>
</tbody>
</table>

<p>Even with fewer variables, this model is arguably as performant as the original.
It does not overfit, and even improves the AUC score by 3%.</p>
<div class="highlight"><pre><span></span><span class="c1"># create data frame of true values and predicted probabilities on test set</span>
<span class="n">pred_proba</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">logreg_lasso_1</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)]</span>

<span class="n">pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;true_values&#39;</span><span class="p">:</span> <span class="n">y_test</span><span class="p">,</span>
                        <span class="s1">&#39;pred_probs&#39;</span><span class="p">:</span><span class="n">pred_proba</span><span class="p">})</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Create figure.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="c1"># Create threshold values.</span>
<span class="n">thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="c1"># Define function to calculate sensitivity. (True positive rate.)</span>
<span class="k">def</span> <span class="nf">TPR</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">true_col</span><span class="p">,</span> <span class="n">pred_prob_col</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
    <span class="n">true_positive</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">true_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">pred_prob_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">false_negative</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">true_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">pred_prob_col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">true_positive</span> <span class="o">/</span> <span class="p">(</span><span class="n">true_positive</span> <span class="o">+</span> <span class="n">false_negative</span><span class="p">)</span>


<span class="c1"># Define function to calculate 1 - specificity. (False positive rate.)</span>
<span class="k">def</span> <span class="nf">FPR</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">true_col</span><span class="p">,</span> <span class="n">pred_prob_col</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
    <span class="n">true_negative</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">true_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">pred_prob_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">false_positive</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">true_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">pred_prob_col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">true_negative</span> <span class="o">/</span> <span class="p">(</span><span class="n">true_negative</span> <span class="o">+</span> <span class="n">false_positive</span><span class="p">))</span>

<span class="c1"># Calculate sensitivity &amp; 1-specificity for each threshold between 0 and 1.</span>
<span class="n">tpr_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">TPR</span><span class="p">(</span><span class="n">pred_df</span><span class="p">,</span> <span class="s1">&#39;true_values&#39;</span><span class="p">,</span> <span class="s1">&#39;pred_probs&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">)</span> <span class="k">for</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">]</span>
<span class="n">fpr_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">FPR</span><span class="p">(</span><span class="n">pred_df</span><span class="p">,</span> <span class="s1">&#39;true_values&#39;</span><span class="p">,</span> <span class="s1">&#39;pred_probs&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">)</span> <span class="k">for</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">]</span>

<span class="c1"># Plot ROC curve.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_values</span><span class="p">,</span> <span class="c1"># False Positive Rate on X-axis</span>
         <span class="n">tpr_values</span><span class="p">,</span> <span class="c1"># True Positive Rate on Y-axis</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ROC Curve&#39;</span><span class="p">)</span>

<span class="c1"># Plot baseline. (Perfect overlap between the two populations.)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
         <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span>
         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Label axes.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;ROC Curve with AUC = {round(roc_auc_score(pred_df[&quot;true_values&quot;], pred_df[&quot;pred_probs&quot;]),2)}&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sensitivity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;1 - Specificity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="c1"># Create legend.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="images/ncaa_98_0.png"></p>
<div class="highlight"><pre><span></span><span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">logreg_lasso_1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
<span class="n">cm_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;predicted negative&#39;</span><span class="p">,</span> <span class="s1">&#39;predicted positive&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;actual negative&#39;</span><span class="p">,</span> <span class="s1">&#39;actual positive&#39;</span><span class="p">])</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">cm_df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s1">&#39;table table-responsive table-striped&#39;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>predicted negative</th>
      <th>predicted positive</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>actual negative</th>
      <td>167</td>
      <td>25</td>
    </tr>
    <tr>
      <th>actual positive</th>
      <td>69</td>
      <td>103</td>
    </tr>
  </tbody>
</table>

<p>There are more false negatives than false positives (predicting no final four, when it is final four). The shape of the ROC Curve is due to the random over sampling.</p>
<h2>Hyperparameter Selection</h2>
<p>Let's fine tune our hyperparameter of alpha with GridSearchCV to see if we can improve our model further.</p>
<div class="highlight"><pre><span></span><span class="n">log_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;penalty&#39;</span><span class="p">:[</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="s2">&quot;l2&quot;</span><span class="p">],</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">log_gridsearch</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span> <span class="n">log_params</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">log_gridsearch</span> <span class="o">=</span> <span class="n">log_gridsearch</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nv">Fitting</span> <span class="mi">5</span> <span class="nv">folds</span> <span class="k">for</span> <span class="nv">each</span> <span class="nv">of</span> <span class="mi">20</span> <span class="nv">candidates</span>, <span class="nv">totalling</span> <span class="mi">100</span> <span class="nv">fits</span>


[<span class="nv">Parallel</span><span class="ss">(</span><span class="nv">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span>]: <span class="nv">Using</span> <span class="nv">backend</span> <span class="nv">LokyBackend</span> <span class="nv">with</span> <span class="mi">2</span> <span class="nv">concurrent</span> <span class="nv">workers</span>.
[<span class="nv">Parallel</span><span class="ss">(</span><span class="nv">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span>]: <span class="nv">Done</span>  <span class="mi">46</span> <span class="nv">tasks</span>      <span class="o">|</span> <span class="nv">elapsed</span>:   <span class="mi">36</span>.<span class="mi">1</span><span class="nv">s</span>
[<span class="nv">Parallel</span><span class="ss">(</span><span class="nv">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span>]: <span class="nv">Done</span> <span class="mi">100</span> <span class="nv">out</span> <span class="nv">of</span> <span class="mi">100</span> <span class="o">|</span> <span class="nv">elapsed</span>:  <span class="mi">1</span>.<span class="mi">4</span><span class="nv">min</span> <span class="nv">finished</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">log_gridsearch</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
<span class="n">log_gridsearch</span><span class="o">.</span><span class="n">best_params_</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="mi">0</span><span class="p">.</span><span class="mi">9175603217158177</span>





<span class="err">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">.</span><span class="mi">445555555555556</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="s1">&#39;l1&#39;</span><span class="err">}</span>
</pre></div>


<p>L1 penalty outperforms L2 penalty. Let's gragh the relationship between the strength of C (lambda) and test accuracy.</p>
<div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">lst_of_c</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">log_gridsearch</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)[</span><span class="s2">&quot;params&quot;</span><span class="p">]]</span>
<span class="n">mean_test_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">log_gridsearch</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)[</span><span class="s2">&quot;mean_test_score&quot;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lst_of_c</span><span class="p">,</span> 
         <span class="n">mean_test_scores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Penalty Strength vs Test Accuracy: {round(log_gridsearch.best_score_,3)}&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="images/ncaa_105_0.png"></p>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">log_gridsearch</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
<span class="n">log_gridsearch</span><span class="o">.</span><span class="n">best_params_</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="mi">0</span><span class="p">.</span><span class="mi">9175603217158177</span>





<span class="err">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">.</span><span class="mi">445555555555556</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="s1">&#39;l1&#39;</span><span class="err">}</span>
</pre></div>


<h2>Best Model</h2>
<div class="highlight"><pre><span></span><span class="c1"># Instantiate Model</span>
<span class="n">logreg_best</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">log_gridsearch</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">])</span>

<span class="c1"># Fit model.</span>
<span class="n">logreg_best</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Generate prediction values</span>
<span class="n">yhat_train</span> <span class="o">=</span> <span class="n">logreg_lasso_1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">yhat_test</span> <span class="o">=</span> <span class="n">logreg_lasso_1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Generate predictions/probabilities</span>
<span class="n">yhat_train_proba</span> <span class="o">=</span> <span class="n">logreg_best</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">yhat_test_proba</span> <span class="o">=</span> <span class="n">logreg_best</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Score the model - accuracy</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg train accuracy: {cross_val_score(logreg_best, X_train, y_train, cv=5).mean()}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg test accuracy: {cross_val_score(logreg_best, X_test, y_test, cv=5).mean()}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Area under the curve</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Area under the curve: {roc_auc_score(y_test, logreg_best.predict_proba(X_test)[:,1])}&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span> <span class="n">Logreg</span> <span class="n">train</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">9168948657714342</span>


 <span class="n">Logreg</span> <span class="n">test</span> <span class="n">accuracy</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">9341591591591591</span>


 <span class="n">Area</span> <span class="k">under</span> <span class="n">the</span> <span class="n">curve</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">786125242248062</span>
</pre></div>


<table class="table">
<thead class="table-responsive table-striped">
<tr>
<th>Metric</th>
<th>Baseline</th>
<th>Logistic Regression, Lasso = 1</th>
<th>Logistic Regression, Lasso = Optimal</th>
</tr>
<tbody>
<tr>
<td>Train Accuracy</td>
<td>94%</td>
<td>90%</td>
<td>92%</td>
</tr>
<tr>
<td>Test Accuracy</td>
<td>96%</td>
<td>92%</td>
<td>93%</td>
</tr>
<tr>
<td>Area under the curve</td>
<td>77%</td>
<td>80%</td>
<td>79%</td>
</tr>
</tbody>
</table>

<div class="highlight"><pre><span></span><span class="n">pred_15_17</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">X_test</span><span class="p">[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;team_id&quot;</span><span class="p">]],</span><span class="n">yhat_test</span><span class="p">))</span>
<span class="n">pred_15_17</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;season&quot;</span><span class="p">:</span> <span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">],</span>
     <span class="s2">&quot;team_id&quot;</span><span class="p">:</span> <span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
     <span class="s2">&quot;final_four&quot;</span><span class="p">:</span> <span class="n">y_test</span><span class="p">,</span>
     <span class="s2">&quot;yhat&quot;</span><span class="p">:</span> <span class="n">yhat_test</span>  
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pred_15_17</span><span class="p">,</span><span class="n">teams</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;final_four&quot;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;final_four==1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s1">&#39;table table-striped table-responsive&#39;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-striped table-responsive">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>season</th>
      <th>team_id</th>
      <th>final_four</th>
      <th>yhat</th>
      <th>team_name</th>
      <th>conference_code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6</th>
      <td>155</td>
      <td>2015.00</td>
      <td>1277.00</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>Michigan St</td>
      <td>big_ten</td>
    </tr>
    <tr>
      <th>17</th>
      <td>421</td>
      <td>2015.00</td>
      <td>1181.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>Duke</td>
      <td>acc</td>
    </tr>
    <tr>
      <th>50</th>
      <td>1077</td>
      <td>2015.00</td>
      <td>1458.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>Wisconsin</td>
      <td>big_ten</td>
    </tr>
    <tr>
      <th>67</th>
      <td>1440</td>
      <td>2016.00</td>
      <td>1314.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>North Carolina</td>
      <td>acc</td>
    </tr>
    <tr>
      <th>94</th>
      <td>2048</td>
      <td>2016.00</td>
      <td>1393.00</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>Syracuse</td>
      <td>acc</td>
    </tr>
    <tr>
      <th>102</th>
      <td>2204</td>
      <td>2016.00</td>
      <td>1437.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>Villanova</td>
      <td>big_east</td>
    </tr>
    <tr>
      <th>119</th>
      <td>2498</td>
      <td>2016.00</td>
      <td>1328.00</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>Oklahoma</td>
      <td>big_twelve</td>
    </tr>
    <tr>
      <th>141</th>
      <td>2997</td>
      <td>2017.00</td>
      <td>1376.00</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>South Carolina</td>
      <td>sec</td>
    </tr>
    <tr>
      <th>153</th>
      <td>3244</td>
      <td>2017.00</td>
      <td>1211.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>Gonzaga</td>
      <td>wcc</td>
    </tr>
    <tr>
      <th>171</th>
      <td>3556</td>
      <td>2017.00</td>
      <td>1332.00</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>Oregon</td>
      <td>pac_twelve</td>
    </tr>
    <tr>
      <th>186</th>
      <td>3857</td>
      <td>2017.00</td>
      <td>1314.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>North Carolina</td>
      <td>acc</td>
    </tr>
  </tbody>
</table>

<hr>
<h1>Results</h1>
<p>Overall, I was able to improve from the baseline logistic model by and 2% in ROC curve. What I am impressed about is that the best model via Lasso is able to predict with less variables, while also maintaining interpretability (no wild transformations), with almost the same level of accuracy for test.</p>
<p>In summary:</p>
<ul>
<li>
<p>Win_% is the most important predictor. Although it's strange to see that it has a negative sign, this is probably the case because schools that make to to the final four actually have lower win % than schools who do not make it to the final four because they face tougher competition (57% avg vs 72% avg). This supports the argument that which conference you play for is very important in predictive power. </p>
</li>
<li>
<p>Again, your strongest conferences, are the big_twelve, acc, big_ten. If you play in acc, your likelihood of reaching final four is very low, because you will likely be dominated by the top tier schools in those conferences. </p>
</li>
<li>
<p>In terms of regular season states, 3PM for and against is important, as the game continues to move shooting more threes, as it's been proven to be an effective strategy. </p>
</li>
<li>
<p>Lastly, seed is not to be overlooked as it's a good composite score for a team's strength, capturing a lot of regular season performance. As your seed increases by 1, your likelihood of reaching final four is 0.5x less. This makes sense... a 3 seed only has a ~12.5% (0.5^3) of making to final four! This is consistent with FiveThirtyEight's forecasts. Purdue, Houston, &amp; Texas Tech had 10-14% of making it to the Final four.</p>
</li>
<li>
<p>Similar to the NBA, margin of victory is a predictive variable though with a positive correlation. In the NBA, there is more parity since each team plays one another at least twice in a season, so individual team stats are more important than seed &amp; conference.</p>
</li>
</ul>
<p>My model predicts the probability of a team reaching the final four, primarily based on its regular season data, seed, and conference. I would recommend coaches to develop the three ball ability, as it continues dominate in the NBA and at the college level, and to outperform in the regular season to improve your seeding, to ultimately improve your chances in moving to the final four, through playing weaker opponents. </p>
<p>Assumptions 
<ul>
<li> In this model, there are things that we cannot predict, including injuries, player specific data, draft prospects, travel &amp; time between games (are players are well rested?), coaches track record, momentum of a team firing on all cylinders (last 10 games), given the absence of data. </li></p>
<li> In this example, there isn't a penalty on false positives vs false negatives, as wrong is wrong. Predicting a loser who won isn't worse than a winner that lost. There may be implications in gambling, but that's out of scope.  </li>

<p>Research Links
<li> https://projects.fivethirtyeight.com/2019-march-madness-predictions/ </li>
</ul></p>
<hr>
<h2>Next Steps</h2>
<p>This was a very fun exploration and may plan to revisit this project in a future blog post.</p>
<p>Ideas:
<ul>
    <li> Simulating winner between 2 games (or at the very least, the final four), using a Poisson model for pts scored </li>
    <li> Logistic vs Non Parametric (KNN, SVM, random forests) </li>
    <li> Scrap 2018 data, and run model, and add graphs (with SMOTE, 2015-&gt;2017 data is obfuscated) </li>
    <li> Feature engineer strength of schedule (they have this on sports reference) </li>
    <li> ELO </li>
    <li> No. of previous appearances in history </li>
    <li> Confidence intervals of predicted probabilities </li>
</ul></p>
  </div>



      <div class="footer">
<div class="disclaimer">

    <p>
      © Garry Chan 2019 &mdash; built with <a href="http://getpelican.com" target="_blank">Pelican</a>, built off of the theme <a href="https://github.com/swanson/lagom" target="_blank">Lagom</a>.
    </p>
  </div>      </div>
    </div>
  </div>

<!-- my kit for font awesome  -->
<script src="https://kit.fontawesome.com/54282dd713.js"></script>
</body>
</html>