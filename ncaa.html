<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Garry Chan">
  <meta name="description" content="Posts by Garry Chan">
  <title>
    Garry's Blog
&ndash; March Madness  </title>

    <link rel="canonical" href="https://garrrychan.github.io/blog/ncaa.html">

  <link href="//fonts.googleapis.com/css?family=Open+Sans:600,800" rel="stylesheet" type="text/css">
  <!------>
  <link rel="shortcut icon" href="https://garrrychan.github.io/blog/theme/images/gary_snail.png">  <link rel="stylesheet" type="text/css" href="https://garrrychan.github.io/blog/theme/css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="https://garrrychan.github.io/blog/theme/css/all.css">
  <link rel="stylesheet" type="text/css" href="https://garrrychan.github.io/blog/theme/css/pygments-monokai.css">
</head>
<body>
  <div class="container">
    <div class="four columns sidebar">
<nav>
  <a href="https://garrrychan.github.io/blog/">
    <img src="https://garrrychan.github.io/blog/theme/images/logo2.jpg" id="gravatar" alt="photo"/>
  </a>
  <h2><a href="https://garrrychan.github.io/blog/">Garry Chan</a></h2>

  <div id="bio">
    <p>I write about data science, and occasionally sports.</p>
    <p>Completed a full time data science program.</p>
    <p>Experience as a tech consultant, with a Bachelors in Mathematics from UWaterloo.</p>
  </div>

  <div id="social">
    <div>
      <i class="fas fa-map-marker-alt fa-2x" style="color:#ddd">
      <span class="location_icon"> <font color=#000> Toronto, Canada </font></span> </i>
      </div>
    <br>
    <a title="Garry on LinkedIn" href="https://www.linkedin.com/in/garrrychan">
      <!--- icons from font awesome are really just fonts fa-2x the size--->
    <i class="fab fa-linkedin fa-2x"></i></a>

    &nbsp &nbsp;
    <a title="Garry on Github" href="https://github.com/garrrychan">
    <i class="fab fa-github fa-2x"></i></a>

    &nbsp &nbsp;
    <a title="Garry's Email" href="mailto: g33chan@uwaterloo.ca">
    <i class="fas fa-envelope-square fa-2x"></i>
    </a>
  </div>
</nav>    </div>

    <div class="eleven columns content">
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>
  <p class="meta">
    18 April 2019
    <a href="https://garrrychan.github.io/blog">
      <!--- home icon--->
      <i class="home fa fa-home fa-2x"></i>
    </a>
  </p>

  <h1 class="title"><a href="https://garrrychan.github.io/blog/ncaa.html">March Madness</a></h1>

  <div class="article_text" id="post">
    <p>How likely is a team to make the Final Four of the NCAA Tournament?</p>
<h1>Introduction</h1>
<p>Each year, close to $4 billion is wagered on the NCAA Division 1 men's basketball tournament. Most of that money is wagered where the objective is to correctly predict winners of each game, with emphasis on the last four teams remaining (the Final Four). </p>
<p>In this project, my motivation is the following:</p>
<p>Based on a college's regular season performance and seeding information, can I predict whether or not they will reach the final four? </p>
<p>What are the variables that are correlated to predicting teams that make it to the final four? As a corollary, my model will also output the associated probabilities of making it to the final 4. Am I able to outperform a naive model? As even the sport pundits will tell you, since 2008, 53% of the time, at least 2 No. 1 seeds make the final four. So just by choosing two No 1. seeds, you're half way there.</p>
<p>As a trusted advisor to Coach Krzyzewski (Duke) or Coach Izzo (Michigan State), how would I recommend spending time developing the team? </p>
<p>Or at the very least, how do I improve my 2020 bracket to make some money?</p>
<hr>
<h1>Preprocessing</h1>
<h2>Import libraries</h2>
<div class="highlight"><pre><span></span><span class="c1"># data wrangling</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c1"># plotting </span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;fivethirtyeight&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>

<span class="c1"># preprocessing &amp; feature engineering</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">LabelBinarizer</span><span class="p">,</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn_pandas</span> <span class="kn">import</span> <span class="n">DataFrameMapper</span><span class="p">,</span> <span class="n">CategoricalImputer</span><span class="p">,</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span>

<span class="c1"># modelling &amp; evaluation</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="c1"># scientific notation off</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">suppress</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># pd.options.display.float_format = &#39;{:.2f}&#39;.format</span>

<span class="c1"># suppress warnings</span>
<span class="kn">from</span> <span class="nn">sklearn.exceptions</span> <span class="kn">import</span> <span class="n">DataConversionWarning</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">DataConversionWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>/Users/gc/anaconda3/lib/python3.6/site-packages/sklearn/externals/six.py:31: DeprecationWarning: The module is deprecated in version 0.21 and will be removed in version 0.23 since we&#39;ve dropped support for Python 2.7. Please rely on the official version of six (https://pypi.org/project/six/).
  &quot;(https://pypi.org/project/six/).&quot;, DeprecationWarning)
</pre></div>


<hr>
<h2>Data</h2>
<p>The data spans 2003 to 2017 and is compiled from <a href="https://www.sports-reference.com/cbb/schools/virginia/2019-gamelogs.html">sports-reference.com</a>. </p>
<p>The data is spread across four files:</p>
<ul>
<li><code>regular_season.csv</code> - gamelogs for every regular season game</li>
<li><code>teams.csv</code> - team_id, names, and conferences</li>
<li><code>march_madness.csv</code> - gamelogs for each NCAA tournament game</li>
<li><code>march_madness_seeds.csv</code> - entry seeds for each team (W, X, Y, Z indicate the region)</li>
</ul>
<h3>Understand the data</h3>
<div class="highlight"><pre><span></span><span class="n">regular</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/ncaa_data/regular_season.csv&quot;</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">regular</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>day_in_season</th>
      <th>winning_team_id</th>
      <th>winning_team_score</th>
      <th>losing_team_id</th>
      <th>losing_team_score</th>
      <th>winning_team_field_goals</th>
      <th>winning_team_field_goals_attempted</th>
      <th>winning_team_three_points</th>
      <th>winning_team_three_points_attempted</th>
      <th>winning_team_free_throws</th>
      <th>winning_team_free_throws_attempted</th>
      <th>winning_team_offensive_rebounds</th>
      <th>winning_team_defensive_rebounds</th>
      <th>winning_team_assists</th>
      <th>winning_team_turnovers</th>
      <th>winning_team_steals</th>
      <th>winning_team_blocks</th>
      <th>winning_team_personal_fouls</th>
      <th>losing_team_field_goals</th>
      <th>losing_team_field_goals_attempted</th>
      <th>losing_team_three_points</th>
      <th>losing_team_three_points_attempted</th>
      <th>losing_team_free_throws</th>
      <th>losing_team_free_throws_attempted</th>
      <th>losing_team_offensive_rebounds</th>
      <th>losing_team_defensive_rebounds</th>
      <th>losing_team_assists</th>
      <th>losing_team_turnovers</th>
      <th>losing_team_steals</th>
      <th>losing_team_blocks</th>
      <th>losing_team_personal_fouls</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>76633</th>
      <td>2017</td>
      <td>132</td>
      <td>1348</td>
      <td>70</td>
      <td>1433</td>
      <td>63</td>
      <td>24</td>
      <td>54</td>
      <td>8</td>
      <td>20</td>
      <td>14</td>
      <td>19</td>
      <td>9</td>
      <td>27</td>
      <td>12</td>
      <td>6</td>
      <td>3</td>
      <td>7</td>
      <td>18</td>
      <td>21</td>
      <td>67</td>
      <td>4</td>
      <td>14</td>
      <td>17</td>
      <td>22</td>
      <td>23</td>
      <td>24</td>
      <td>8</td>
      <td>5</td>
      <td>4</td>
      <td>1</td>
      <td>16</td>
    </tr>
    <tr>
      <th>76634</th>
      <td>2017</td>
      <td>132</td>
      <td>1374</td>
      <td>71</td>
      <td>1153</td>
      <td>56</td>
      <td>26</td>
      <td>52</td>
      <td>10</td>
      <td>19</td>
      <td>9</td>
      <td>13</td>
      <td>7</td>
      <td>27</td>
      <td>14</td>
      <td>8</td>
      <td>2</td>
      <td>6</td>
      <td>15</td>
      <td>19</td>
      <td>61</td>
      <td>4</td>
      <td>24</td>
      <td>14</td>
      <td>18</td>
      <td>17</td>
      <td>22</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>1</td>
      <td>13</td>
    </tr>
    <tr>
      <th>76635</th>
      <td>2017</td>
      <td>132</td>
      <td>1407</td>
      <td>59</td>
      <td>1402</td>
      <td>53</td>
      <td>21</td>
      <td>60</td>
      <td>1</td>
      <td>17</td>
      <td>16</td>
      <td>19</td>
      <td>14</td>
      <td>19</td>
      <td>5</td>
      <td>5</td>
      <td>10</td>
      <td>3</td>
      <td>10</td>
      <td>20</td>
      <td>48</td>
      <td>6</td>
      <td>17</td>
      <td>7</td>
      <td>8</td>
      <td>9</td>
      <td>27</td>
      <td>10</td>
      <td>17</td>
      <td>1</td>
      <td>7</td>
      <td>18</td>
    </tr>
  </tbody>
</table>

<p>Let's understand the last row. 
1407 = Troy, 1402 = Texas State.
Troy beat Texas State 59 to 53 on 132 day in season which is Sunday, March 2017. (Technically, 2016 - 2017 Season). Notice that all games finish on day 132 in each year.</p>
<div class="highlight"><pre><span></span><span class="c1"># regular.info()</span>
<span class="c1"># regular.describe()</span>
</pre></div>


<ul>
<li>32 variables</li>
<li>games from 2003 to 2017</li>
<li>stats per each team, team id</li>
<li>no null values, all ints</li>
<li>2018 is left out in this data set</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/ncaa_data/teams.csv&quot;</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">teams</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>team_id</th>
      <th>team_name</th>
      <th>conference_code</th>
      <th>conference_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2014</td>
      <td>1101</td>
      <td>Abilene Chr</td>
      <td>southland</td>
      <td>Southland Conference</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015</td>
      <td>1101</td>
      <td>Abilene Chr</td>
      <td>southland</td>
      <td>Southland Conference</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2016</td>
      <td>1101</td>
      <td>Abilene Chr</td>
      <td>southland</td>
      <td>Southland Conference</td>
    </tr>
  </tbody>
</table>

<div class="highlight"><pre><span></span><span class="n">teams</span> <span class="o">=</span> <span class="n">teams</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;conference_name&quot;</span><span class="p">])</span>
</pre></div>


<ul>
<li>use to join team name, conference code to easily interpret</li>
<li>drop conference name, it's redundant</li>
<li>conference info from 2003 to 2018</li>
<li>no null values, int and object looks good</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">mm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/ncaa_data/march_madness.csv&quot;</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">mm</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>day_in_season</th>
      <th>winning_team_id</th>
      <th>winning_team_score</th>
      <th>losing_team_id</th>
      <th>losing_team_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1985</td>
      <td>136</td>
      <td>1116</td>
      <td>63</td>
      <td>1234</td>
      <td>54</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1985</td>
      <td>136</td>
      <td>1120</td>
      <td>59</td>
      <td>1345</td>
      <td>58</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1985</td>
      <td>136</td>
      <td>1207</td>
      <td>68</td>
      <td>1250</td>
      <td>43</td>
    </tr>
  </tbody>
</table>

<ul>
<li>1985 to 2017 data about game logs for NCAA tournament</li>
<li>scores, winning team &amp; losing team </li>
<li>use 1985 -&gt; 2017 data to predict 2018</li>
<li>day 134, 135 are for first four, associated with 'a', 'b' seeds, they play to finalize seeding for final 64</li>
<li>e.g. 11 Wake Forest 88, 11 Kansas State 95</li>
<li>first day of round of 64 is 136</li>
<li>last game is 154, which is the national champion</li>
<li>e.g. UNC beat Gonzaga on Day 154 in 2017</li>
<li>Let's drop 1985-&gt;2002 data, since I don't have regular season, seed or conference information for those years.</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">mm</span> <span class="o">=</span> <span class="n">mm</span><span class="p">[</span><span class="n">mm</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">2003</span><span class="p">]</span>
<span class="n">seeds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/ncaa_data/march_madness_seeds.csv&quot;</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">seeds</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>seed</th>
      <th>team_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2003</td>
      <td>W01</td>
      <td>1328</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2003</td>
      <td>W02</td>
      <td>1448</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2003</td>
      <td>W03</td>
      <td>1393</td>
    </tr>
  </tbody>
</table>

<ul>
<li>seed information from 2003 to 2018</li>
<li>there are 68 seeds</li>
<li>Starting in 2011, NCAA tournament starts with 68 teams (e.g. 68 seeds), then dwindles down to 64.</li>
<li>8 lowest seeded teams play in the ‘first four’, and then the winners, come out to be apart of the 64.</li>
<li>merge to use seed as a variable, join on team_id</li>
<li>seed needs to be an int; let's remove the region, it doesn't really matter, what we care about are the raw seeds, treat Y16a and Y16b as 16</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">seeds</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seeds</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">seed_and_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">seeds</span><span class="p">,</span> <span class="n">teams</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="c1"># 996 unique teams</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">seed_and_names</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>seed</th>
      <th>team_id</th>
      <th>team_name</th>
      <th>conference_code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2003</td>
      <td>1</td>
      <td>1328</td>
      <td>Oklahoma</td>
      <td>big_twelve</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2003</td>
      <td>2</td>
      <td>1448</td>
      <td>Wake Forest</td>
      <td>acc</td>
    </tr>
    <tr>
      <th>56</th>
      <td>2003</td>
      <td>3</td>
      <td>1393</td>
      <td>Syracuse</td>
      <td>big_east</td>
    </tr>
  </tbody>
</table>

<ul>
<li>I need a label to indicate if the team is in the final 4</li>
<li>e.g. in 2017, final four were Gonzaga, South Carolina, Oregon and North Carolina</li>
<li>1211, 1376, 1322, 1314 respectively</li>
<li>So, we can see that on day 154, the national championship game was played, and the winner was North Carolina</li>
<li>Moreover, the final four teams are North Carolina vs Oregon, and Gonzaga vs South Carolina</li>
<li>These correspond to games played on 152</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">HTML</span><span class="p">(</span><span class="n">mm</span><span class="p">[</span><span class="n">mm</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">==</span><span class="mi">2017</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>day_in_season</th>
      <th>winning_team_id</th>
      <th>winning_team_score</th>
      <th>losing_team_id</th>
      <th>losing_team_score</th>
      <th>final_four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2112</th>
      <td>2017</td>
      <td>146</td>
      <td>1314</td>
      <td>75</td>
      <td>1246</td>
      <td>73</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2113</th>
      <td>2017</td>
      <td>146</td>
      <td>1376</td>
      <td>77</td>
      <td>1196</td>
      <td>70</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2114</th>
      <td>2017</td>
      <td>152</td>
      <td>1211</td>
      <td>77</td>
      <td>1376</td>
      <td>73</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2115</th>
      <td>2017</td>
      <td>152</td>
      <td>1314</td>
      <td>77</td>
      <td>1332</td>
      <td>76</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2116</th>
      <td>2017</td>
      <td>154</td>
      <td>1314</td>
      <td>71</td>
      <td>1211</td>
      <td>65</td>
      <td>0</td>
    </tr>
  </tbody>
</table>

<p>We can see the championship game was also played on 154, final four played on 152! 
Perfect, now we can flag all of these teams as final four = 1</p>
<p>We'll query the winning_team_id and losing_team_id for each of those games to get the final four teams</p>
<div class="highlight"><pre><span></span><span class="c1"># 15 seasons, we should get 2*15 = 30 final four games</span>
<span class="n">mm</span><span class="p">[</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">mm</span><span class="p">[</span><span class="s2">&quot;day_in_season&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">152</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>


<hr>
<h2>Define X and y</h2>
<p>Let's define X and y so we can more easily perform EDA, feature engineering and modeling.
First, we'll need a target vector y, with all the teams in each season and whether or not
they made it to the Final Four.</p>
<p>Let's work off the seeds_and_names data frame, as those are all of our 996 participating colleges for each season.</p>
<div class="highlight"><pre><span></span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">))</span> <span class="c1"># zeros</span>

<span class="n">final_four_list</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">mm</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;final_four==1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">season</span><span class="p">,</span><span class="n">mm</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;final_four==1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">winning_team_id</span><span class="p">))</span><span class="o">+</span>
     <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">mm</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;final_four==1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">season</span><span class="p">,</span><span class="n">mm</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;final_four==1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">losing_team_id</span><span class="p">)))</span>

<span class="c1"># fill in teams with 1 if final_four team</span>
<span class="k">for</span> <span class="n">season</span><span class="p">,</span> <span class="n">team_id</span> <span class="ow">in</span> <span class="n">final_four_list</span><span class="p">:</span>
    <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span><span class="o">+=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">seed_and_names</span><span class="o">.</span><span class="n">season</span><span class="o">==</span><span class="n">season</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="o">.</span><span class="n">team_id</span><span class="o">==</span><span class="n">team_id</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">HTML</span><span class="p">(</span><span class="n">seed_and_names</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;final_four==1 &amp; season==2017&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-responsive table-striped table-bordered&quot;</span><span class="p">))</span>
</pre></div>


<table border="1" class="dataframe table table-responsive table-striped table-bordered">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>seed</th>
      <th>team_id</th>
      <th>team_name</th>
      <th>conference_code</th>
      <th>conference_name</th>
      <th>final_four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>23045</th>
      <td>2017</td>
      <td>7</td>
      <td>1376</td>
      <td>South Carolina</td>
      <td>sec</td>
      <td>Southeastern Conference</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>23292</th>
      <td>2017</td>
      <td>1</td>
      <td>1211</td>
      <td>Gonzaga</td>
      <td>wcc</td>
      <td>West Coast Conference</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>23604</th>
      <td>2017</td>
      <td>3</td>
      <td>1332</td>
      <td>Oregon</td>
      <td>pac_twelve</td>
      <td>Pacific-12 Conference</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>23905</th>
      <td>2017</td>
      <td>1</td>
      <td>1314</td>
      <td>North Carolina</td>
      <td>acc</td>
      <td>Atlantic Coast Conference</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>

<p>Great, now we have a final_four which will be our target y. Now we have to aggregate the stats for each
team, over all the 76636 games played.</p>
<p>e.g. for South Carolina, we now need the following aggregated stats for, points for, points against, etc.
Aggregating opponents stats so we have a sense of offensive and defensive ability because
defense wins champions!</p>
<div class="highlight"><pre><span></span><span class="c1"># for each time a a specific team won, sum up all of their points</span>
<span class="c1"># for each time a specific team lose, sum of all of their points</span>
<span class="c1"># sum up points from won and lost games</span>

<span class="c1"># let&#39;s use team 1102 (Airforce)</span>
<span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;winning_team_id==1102 &amp; season==2003&quot;</span><span class="p">)[</span><span class="s2">&quot;winning_team_score&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span>825
</pre></div>


<div class="highlight"><pre><span></span><span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;losing_team_id==1102 &amp; season==2003&quot;</span><span class="p">)[</span><span class="s2">&quot;losing_team_score&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span>778
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># also find out the points allowed by Airforce when they win</span>
<span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;winning_team_id==1102 &amp; season==2003&quot;</span><span class="p">)[</span><span class="s2">&quot;losing_team_score&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span>638
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># also find out the points allowed by Airforce when they lose</span>
<span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;losing_team_id==1102 &amp; season==2003&quot;</span><span class="p">)[</span><span class="s2">&quot;winning_team_score&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># points allowed total 1596</span>
</pre></div>


<div class="highlight"><pre><span></span>958
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Let&#39;s write a function to automate this for any team and season</span>
<span class="c1"># Note, ran into error with Wichita St. since they were undefeated, </span>
<span class="c1"># need to add try except clause, to avoid indexing issues</span>

<span class="k">def</span> <span class="nf">points_for</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function generates the team&#39;s total points scored in a season.</span>
<span class="sd">    points_for(1102,2003) &gt;&gt;&gt; 1603&#39;&#39;&#39;</span>
    <span class="c1"># points from winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># points from losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">points_against</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span><span class="n">season</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This function generates the team&#39;s points against in a season.</span>
<span class="sd">    points_against(1102,2003) &gt;&gt; 1596&#39;&#39;&#39;</span>
    <span class="c1"># points allowed from winning games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># points allowed from losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">time</span> 

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;points_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                      <span class="n">points_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                    <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;points_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                    <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                          <span class="n">points_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                         <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>CPU times: user 3min 15s, sys: 18.5 s, total: 3min 34s
Wall time: 2min 15s
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">Now</span> <span class="n">that</span> <span class="n">we</span> <span class="n">have</span> <span class="n">a</span> <span class="n">formula</span><span class="p">,</span> <span class="n">let</span><span class="s1">&#39;s repeat this for all the other columns.</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fg_for</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_field_goals&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_field_goals&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">fg_against</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_field_goals&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_field_goals&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>


<span class="k">def</span> <span class="nf">fga_for</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_field_goals_attempted&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_field_goals_attempted&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">fga_against</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_field_goals_attempted&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_field_goals_attempted&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>



<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;fg_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                      <span class="n">fg_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                    <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;fg_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                    <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                          <span class="n">fg_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                         <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>


<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;fga_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                      <span class="n">fga_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                    <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;fga_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                    <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                          <span class="n">fga_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                         <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">threes_for</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_three_points&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_three_points&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">threes_against</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_three_points&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_three_points&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">threes_a_for</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_three_points_attempted&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_three_points_attempted&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">threes_a_against</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_three_points_attempted&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_three_points__attempted&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>


<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;3pm_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                      <span class="n">threes_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                    <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;3pm_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                    <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                          <span class="n">threes_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                         <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>


<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;3pa_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                      <span class="n">threes_a_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                    <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;3pa_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                    <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                          <span class="n">threes_a_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                         <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ft_for</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_free_throws&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_free_throws&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">ft_against</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_free_throws&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_free_throws&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">fta_for</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_free_throws_attempted&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_free_throws_attempted&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">fta_against</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_free_throws_attempted&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_free_throws_attempted&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>



<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;ft_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                      <span class="n">ft_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                    <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;ft_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                    <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                          <span class="n">ft_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                         <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>



<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;fta_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                      <span class="n">fta_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                    <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;fta_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                    <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                          <span class="n">fta_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                         <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">offensive_rebounds_for</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_offensive_rebounds&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_offensive_rebounds&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">offensive_rebounds_against</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_offensive_rebounds&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_offensive_rebounds&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">defensive_rebounds_for</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_defensive_rebounds&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_defensive_rebounds&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">defensive_rebounds_against</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_defensive_rebounds&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_defensive_rebounds&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>


<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;off_rebounds_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                      <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                      <span class="n">offensive_rebounds_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                             <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;off_rebounds_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                          <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                          <span class="n">offensive_rebounds_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                                     <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>


<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;def_rebounds_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                      <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                            <span class="n">defensive_rebounds_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                                   <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;def_rebounds_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                          <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                                <span class="n">defensive_rebounds_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                                           <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">assists_for</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_assists&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_assists&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">assists_against</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_assists&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_assists&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>


<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;assists_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                      <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                      <span class="n">assists_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                             <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;assists_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                          <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                          <span class="n">assists_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                                     <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">steals_for</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_steals&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_steals&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">steals_against</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_steals&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_steals&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">blocks_for</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_blocks&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_blocks&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">blocks_against</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_blocks&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_blocks&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>


<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;steals_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                      <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                      <span class="n">steals_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                             <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;steals_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                          <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                          <span class="n">steals_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                                     <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>


<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;blocks_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                      <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                            <span class="n">blocks_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                                   <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;blocks_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                          <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                                <span class="n">blocks_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                               <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">turnovers_for</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_turnovers&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_turnovers&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">turnovers_against</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_turnovers&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_turnovers&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">fouls_for</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_personal_fouls&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_personal_fouls&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>

<span class="k">def</span> <span class="nf">fouls_against</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="c1">#winning games</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;losing_team_personal_fouls&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#losing games</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;winning_team_personal_fouls&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>


<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;turnovers_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                      <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                      <span class="n">turnovers_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                             <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;turnovers_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                          <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                          <span class="n">turnovers_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                                     <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>


<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;fouls_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                      <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                            <span class="n">fouls_for</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                                   <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;fouls_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed_and_names</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                                          <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seed_and_names</span><span class="p">:</span> 
                                                <span class="n">fouls_against</span><span class="p">(</span><span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                                               <span class="n">seed_and_names</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">regular_season_total</span> <span class="o">=</span> <span class="n">seed_and_names</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">regular_season_total</span><span class="o">.</span><span class="n">columns</span>
</pre></div>


<div class="highlight"><pre><span></span>Index([&#39;season&#39;, &#39;seed&#39;, &#39;team_id&#39;, &#39;team_name&#39;, &#39;conference_code&#39;,
       &#39;final_four&#39;, &#39;points_for&#39;, &#39;points_against&#39;, &#39;fg_for&#39;, &#39;fg_against&#39;,
       &#39;fga_for&#39;, &#39;fga_against&#39;, &#39;3pm_for&#39;, &#39;3pm_against&#39;, &#39;3pa_for&#39;,
       &#39;3pa_against&#39;, &#39;ft_for&#39;, &#39;ft_against&#39;, &#39;fta_for&#39;, &#39;fta_against&#39;,
       &#39;off_rebounds_for&#39;, &#39;off_rebounds_against&#39;, &#39;def_rebounds_for&#39;,
       &#39;def_rebounds_against&#39;, &#39;assists_for&#39;, &#39;assists_against&#39;, &#39;steals_for&#39;,
       &#39;steals_against&#39;, &#39;blocks_for&#39;, &#39;blocks_against&#39;, &#39;turnovers_for&#39;,
       &#39;turnovers_against&#39;, &#39;fouls_for&#39;, &#39;fouls_against&#39;],
      dtype=&#39;object&#39;)
</pre></div>


<hr>
<h2>Train Test Split</h2>
<ul>
<li>As always, let's train test split (80% / 20%). Given it's time series we can split on years.</li>
<li>There are 15 years of data, so we'll train on 12 years and test on the final 3 years (2015, 2016, 2017)</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">y_test</span> <span class="o">=</span> <span class="n">regular_season_total</span><span class="p">[</span><span class="n">regular_season_total</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">2015</span><span class="p">][</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">regular_season_total</span><span class="p">[</span><span class="n">regular_season_total</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">2015</span><span class="p">][</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">regular_season_total</span><span class="p">[[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="s1">&#39;team_id&#39;</span><span class="p">,</span> <span class="s1">&#39;team_name&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;points_for&#39;</span><span class="p">,</span> <span class="s1">&#39;points_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_against&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;3pm_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_for&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;3pa_against&#39;</span><span class="p">,</span> <span class="s1">&#39;ft_for&#39;</span><span class="p">,</span> <span class="s1">&#39;ft_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_against&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">,</span> <span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">,</span> <span class="s1">&#39;assists_for&#39;</span><span class="p">,</span> <span class="s1">&#39;assists_against&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_for&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;steals_against&#39;</span><span class="p">,</span> <span class="s1">&#39;blocks_for&#39;</span><span class="p">,</span> <span class="s1">&#39;blocks_against&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_for&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;turnovers_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fouls_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fouls_against&#39;</span><span class="p">]]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;season&lt;2015&quot;</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;season&gt;=2015&quot;</span><span class="p">)</span>
</pre></div>


<hr>
<h2>Imputation</h2>
<ul>
<li>Data is pretty complete and in the right type which is great. We'll just need to create multi class labels, such that we can identify which conferences a team is in, as I suspect that some teams play in more competitive conferences than others.</li>
<li>Let's label qualitative variables.</li>
<li>We'll standardize after splitting.</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">mapper</span> <span class="o">=</span> <span class="n">DataFrameMapper</span><span class="p">([</span>
    <span class="p">([</span><span class="s1">&#39;season&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;seed&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;team_id&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;conference_code&#39;</span><span class="p">],</span><span class="n">LabelBinarizer</span><span class="p">()),</span>    
    <span class="p">([</span><span class="s1">&#39;points_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;points_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fg_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fg_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;3pm_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span> 
    <span class="p">([</span><span class="s1">&#39;3pm_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span> 
    <span class="p">([</span><span class="s1">&#39;fga_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fga_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;3pa_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span> 
    <span class="p">([</span><span class="s1">&#39;3pa_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;ft_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>  
    <span class="p">([</span><span class="s1">&#39;ft_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fta_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fta_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;assists_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;assists_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;steals_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;steals_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;blocks_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;blocks_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;turnovers_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;turnovers_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fouls_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fouls_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">)</span>
<span class="p">],</span><span class="n">df_out</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">Z_train</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">Z_test</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> <span class="c1"># you never want to fit because if you see something you never saw before emoji</span>
<span class="c1"># then it will be &#39;labelbinarized&#39;, when it fact it should be treated as something diff instead</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># problem</span>
<span class="c1"># list(zip(Z_train.columns,Z_test.columns)) # there are less conferences in 2015 -&gt; 2018</span>
<span class="c1"># mid_cont, pac_ten are in Z_train but not in Z_test</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">teams</span><span class="p">[</span><span class="n">teams</span><span class="p">[</span><span class="s2">&quot;conference_code&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;mid_cont&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;season&quot;</span><span class="p">)</span> <span class="c1"># only occured 2004-&gt;2007</span>
<span class="c1"># Chicago moved from mid_cont to gwc in 2010</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>team_id</th>
      <th>team_name</th>
      <th>conference_code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14628</th>
      <td>2004</td>
      <td>1147</td>
      <td>Centenary</td>
      <td>mid_cont</td>
    </tr>
    <tr>
      <th>14629</th>
      <td>2005</td>
      <td>1147</td>
      <td>Centenary</td>
      <td>mid_cont</td>
    </tr>
    <tr>
      <th>14630</th>
      <td>2006</td>
      <td>1147</td>
      <td>Centenary</td>
      <td>mid_cont</td>
    </tr>
    <tr>
      <th>14631</th>
      <td>2007</td>
      <td>1147</td>
      <td>Centenary</td>
      <td>mid_cont</td>
    </tr>
    <tr>
      <th>16279</th>
      <td>2003</td>
      <td>1152</td>
      <td>Chicago St</td>
      <td>mid_cont</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">teams</span><span class="p">[</span><span class="n">teams</span><span class="p">[</span><span class="s2">&quot;conference_code&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;pac_ten&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;season&quot;</span><span class="p">)</span> <span class="c1"># only occured 2003-&gt;2011;</span>
<span class="c1"># in 2012, Arizona played in pac_twelmanually add ve</span>
<span class="c1"># let&#39;s be more verbose and label mid_cont in pac_ten columns in test, with 0 so they&#39;re the same width</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>team_id</th>
      <th>team_name</th>
      <th>conference_code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3601</th>
      <td>2003</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3602</th>
      <td>2004</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3603</th>
      <td>2005</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3604</th>
      <td>2006</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3605</th>
      <td>2007</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3606</th>
      <td>2008</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3607</th>
      <td>2009</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3608</th>
      <td>2010</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
    <tr>
      <th>3609</th>
      <td>2011</td>
      <td>1112</td>
      <td>Arizona</td>
      <td>pac_ten</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">Z_test</span><span class="p">[</span><span class="s2">&quot;conference_code_pac_ten&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Z_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">Z_test</span><span class="p">[</span><span class="s2">&quot;conference_code_mid_cont&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Z_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)))</span>

<span class="c1">#Showing up as NaN -&gt; need to make zero</span>
<span class="n">Z_test</span><span class="p">[</span><span class="s2">&quot;conference_code_pac_ten&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Z_test</span><span class="p">[</span><span class="s2">&quot;conference_code_mid_cont&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<hr>
<h2>Establish Benchmarks</h2>
<p>Let's quickly spin up a naive baseline/benchmark model &amp; naive out the door. Then, in subsequent steps, we can feature engineering and model to improve our score!</p>
<p>From FiveThirtyEight, 1 seeds only had a 35%-52% of reaching the final four.</p>
<p><img src="./images/ncaa.png"  width="620" height="120"></p>
<p>Let's see how how our naive model's prediction fared.</p>
<div class="highlight"><pre><span></span><span class="c1"># Baseline logistic </span>

<span class="c1"># Step 1: Instantiate our model.</span>
<span class="n">logreg_baseline</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 2: Fit our model.</span>
<span class="n">logreg_baseline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Z_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Step 3 (part 1): Generate prediction values</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Number of teams making it to final four: {sum(logreg_baseline.predict(Z_train))}&#39;</span><span class="p">)</span>

<span class="c1"># Step 3 (part 2): Generate predictions/probabilities</span>
<span class="n">logreg_baseline</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">Z_train</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Step 4: Score the model:</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg train accuracy: {logreg_baseline.score(Z_train,y_train)}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg test accuracy: {logreg_baseline.score(Z_test,y_test)}&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>Number of teams making it to final four: 20
 Logreg train accuracy: 0.946969696969697
 Logreg test accuracy: 0.9656862745098039
</pre></div>


<hr>
<h3>Imbalanced Classes</h3>
<ul>
<li>Accuracy of 94% looks good right? However, we have imbalanced classes.</li>
<li>Over 15 years, 60 final four teams, 936 non-final four, 996 total.</li>
<li>1-60/996 = 94%</li>
<li>Any naive model would be equally as good as this baseline logistic regression, by simply taking the accuracy.</li>
<li>This is a misleading accuracy as it's overestimated. Let's quickly spin up a AUC score to score the accuracy of this logistic classifier, and measure this imbalance.</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">logreg_baseline</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">Z_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span>0.7777777777777778
</pre></div>


<p>See how the area under the curve score is close to 50%. With this model (trained on imbalanced classes), we are no better than a 'no information' classifer.</p>
<p>To get a better metric of our baseline model, let's better represent the minority class (final four)
with more signal, via SMOTE (Synthetic Minority Over-Sampling Technique).</p>
<div class="highlight"><pre><span></span><span class="c1"># added final_four to this mapper so I can split after, preserve order rather than randomly splitting</span>
<span class="n">mapper_all</span> <span class="o">=</span> <span class="n">DataFrameMapper</span><span class="p">([</span>
    <span class="p">([</span><span class="s1">&#39;season&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;seed&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;team_id&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;conference_code&#39;</span><span class="p">],</span><span class="n">LabelBinarizer</span><span class="p">()),</span>    
    <span class="p">([</span><span class="s1">&#39;final_four&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;points_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;points_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fg_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fg_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;3pm_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span> 
    <span class="p">([</span><span class="s1">&#39;3pm_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span> 
    <span class="p">([</span><span class="s1">&#39;fga_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fga_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;3pa_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span> 
    <span class="p">([</span><span class="s1">&#39;3pa_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;ft_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>  
    <span class="p">([</span><span class="s1">&#39;ft_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fta_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fta_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;assists_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;assists_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;steals_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;steals_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;blocks_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;blocks_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;turnovers_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;turnovers_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fouls_for&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">),</span>
    <span class="p">([</span><span class="s1">&#39;fouls_against&#39;</span><span class="p">],</span><span class="bp">None</span><span class="p">)</span>
<span class="p">],</span><span class="n">df_out</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">mapper_all</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">regular_season_total</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[[</span><span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="s1">&#39;team_id&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_a_sun&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_a_ten&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_aac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_acc&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_aec&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_big_east&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_big_sky&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_big_south&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_big_ten&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_big_twelve&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_big_west&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_caa&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_cusa&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_horizon&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_ivy&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_maac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_mac&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_meac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_mid_cont&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_mvc&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_mwc&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_nec&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_ovc&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_pac_ten&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_pac_twelve&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_patriot&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_sec&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_southern&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_southland&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_summit&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_sun_belt&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_swac&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_wac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_wcc&#39;</span><span class="p">,</span>
       <span class="s1">&#39;points_for&#39;</span><span class="p">,</span> <span class="s1">&#39;points_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;3pm_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;ft_for&#39;</span><span class="p">,</span> <span class="s1">&#39;ft_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_against&#39;</span><span class="p">,</span> <span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;assists_for&#39;</span><span class="p">,</span> <span class="s1">&#39;assists_against&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_for&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;blocks_for&#39;</span><span class="p">,</span> <span class="s1">&#39;blocks_against&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_for&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;fouls_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fouls_against&#39;</span><span class="p">]]</span>

<span class="c1"># instantiate SMOTE</span>
<span class="n">smote</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">ratio</span><span class="o">=</span><span class="s1">&#39;minority&#39;</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">X_sm</span><span class="p">,</span> <span class="n">y_sm</span> <span class="o">=</span> <span class="n">smote</span><span class="o">.</span><span class="n">fit_sample</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">X_sm</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> 
<span class="k">print</span><span class="p">(</span><span class="n">y_sm</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># there are 936 final four rows and 936 non-final four</span>
<span class="k">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">y_sm</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>(1872, 65)
(1872,)
936
</pre></div>


<p>Let's recalculate accuracy and auc</p>
<div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_sm</span><span class="p">),</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_sm</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;final_four&#39;</span><span class="p">,</span><span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="s1">&#39;team_id&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_a_sun&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_a_ten&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_aac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_acc&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_aec&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_big_east&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_big_sky&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_big_south&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_big_ten&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_big_twelve&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_big_west&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_caa&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_cusa&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_horizon&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_ivy&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_maac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_mac&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_meac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_mid_cont&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_mvc&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_mwc&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_nec&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_ovc&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_pac_ten&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_pac_twelve&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_patriot&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_sec&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_southern&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_southland&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_summit&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_sun_belt&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_swac&#39;</span><span class="p">,</span>
       <span class="s1">&#39;conference_code_wac&#39;</span><span class="p">,</span> <span class="s1">&#39;conference_code_wcc&#39;</span><span class="p">,</span> <span class="s1">&#39;points_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;points_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;fga_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_against&#39;</span><span class="p">,</span> <span class="s1">&#39;ft_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;ft_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_against&#39;</span><span class="p">,</span> <span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;assists_for&#39;</span><span class="p">,</span> <span class="s1">&#39;assists_against&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_for&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;blocks_for&#39;</span><span class="p">,</span> <span class="s1">&#39;blocks_against&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_for&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;fouls_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fouls_against&#39;</span><span class="p">]</span>

<span class="c1"># Let&#39;s split on the years again</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">2015</span><span class="p">][</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">2015</span><span class="p">][</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>

<span class="c1"># 269/1603 so about 17%/83% split which is fine, I prefer the interpretability and preserve meaning.</span>
<span class="c1"># We are using 2003 -&gt; 2014 data to predict and test 2015, 2016, 2017.</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;season&quot;</span><span class="p">:</span><span class="s2">&quot;fouls_against&quot;</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">2015</span><span class="p">]</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">2015</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>(1603, 65)
(1603,)


(269, 65)
(269,)
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Baseline logistic </span>

<span class="c1"># Step 1: Instantiate our model.</span>
<span class="n">logreg_baseline</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Step 2: Fit our model.</span>
<span class="n">logreg_baseline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Step 3 (part 1): Generate prediction values</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Number of teams making it to final four: {sum(logreg_baseline.predict(X_train))}&#39;</span><span class="p">)</span>

<span class="c1"># Step 3 (part 2): Generate predictions/probabilities</span>
<span class="n">logreg_baseline</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Step 4: Score the model:</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg train accuracy: {cross_val_score(logreg_baseline, X_train, y_train, cv=5).mean()}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg test accuracy: {cross_val_score(logreg_baseline, X_test, y_test, cv=5).mean()}&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>Number of teams making it to final four: 837
 Logreg train accuracy: 0.9532202462914677
 Logreg test accuracy: 0.9221269296740996
</pre></div>


<div class="highlight"><pre><span></span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">logreg_baseline</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span>0.9602949134199135
</pre></div>


<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; seed coeff {np.exp(-0.608454)}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; acc coeff {np.exp(-3.538678)}&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span> seed coeff 0.5441915391886456
 acc coeff 0.029051708064839428
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">logreg_baseline</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])))</span>
<span class="c1"># The seed is very important.</span>
<span class="c1"># Remember, need to take exponential. If your seed increases by 1, your likelihood of reaching final four</span>
<span class="c1"># is 0.54x less</span>
<span class="c1"># The individual team stats are less important, as I suspect the seed already captures a lot of that information.</span>

<span class="c1"># And what conference you play in matters (acc, big_twelve or big_ten)</span>
<span class="c1"># If you play in acc, your likelihood of reaching final four is 0.03x less, this is probably explaining</span>
<span class="c1"># for the teams who are not top tier.</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>season</td>
      <td>-0.001062</td>
    </tr>
    <tr>
      <th>1</th>
      <td>seed</td>
      <td>-0.439209</td>
    </tr>
    <tr>
      <th>2</th>
      <td>team_id</td>
      <td>-0.000361</td>
    </tr>
    <tr>
      <th>3</th>
      <td>conference_code_a_sun</td>
      <td>-0.039266</td>
    </tr>
    <tr>
      <th>4</th>
      <td>conference_code_a_ten</td>
      <td>-1.133449</td>
    </tr>
    <tr>
      <th>5</th>
      <td>conference_code_aac</td>
      <td>-0.078609</td>
    </tr>
    <tr>
      <th>6</th>
      <td>conference_code_acc</td>
      <td>-1.668645</td>
    </tr>
    <tr>
      <th>7</th>
      <td>conference_code_aec</td>
      <td>-0.026041</td>
    </tr>
    <tr>
      <th>8</th>
      <td>conference_code_big_east</td>
      <td>-1.204675</td>
    </tr>
    <tr>
      <th>9</th>
      <td>conference_code_big_sky</td>
      <td>-0.012483</td>
    </tr>
    <tr>
      <th>10</th>
      <td>conference_code_big_south</td>
      <td>-0.025224</td>
    </tr>
    <tr>
      <th>11</th>
      <td>conference_code_big_ten</td>
      <td>-0.618794</td>
    </tr>
    <tr>
      <th>12</th>
      <td>conference_code_big_twelve</td>
      <td>-1.790391</td>
    </tr>
    <tr>
      <th>13</th>
      <td>conference_code_big_west</td>
      <td>-0.035615</td>
    </tr>
    <tr>
      <th>14</th>
      <td>conference_code_caa</td>
      <td>0.459960</td>
    </tr>
    <tr>
      <th>15</th>
      <td>conference_code_cusa</td>
      <td>-0.361446</td>
    </tr>
    <tr>
      <th>16</th>
      <td>conference_code_horizon</td>
      <td>0.509026</td>
    </tr>
    <tr>
      <th>17</th>
      <td>conference_code_ivy</td>
      <td>-0.021336</td>
    </tr>
    <tr>
      <th>18</th>
      <td>conference_code_maac</td>
      <td>-0.036216</td>
    </tr>
    <tr>
      <th>19</th>
      <td>conference_code_mac</td>
      <td>-0.045925</td>
    </tr>
    <tr>
      <th>20</th>
      <td>conference_code_meac</td>
      <td>-0.014014</td>
    </tr>
    <tr>
      <th>21</th>
      <td>conference_code_mid_cont</td>
      <td>-0.008154</td>
    </tr>
    <tr>
      <th>22</th>
      <td>conference_code_mvc</td>
      <td>-0.398462</td>
    </tr>
    <tr>
      <th>23</th>
      <td>conference_code_mwc</td>
      <td>-0.824229</td>
    </tr>
    <tr>
      <th>24</th>
      <td>conference_code_nec</td>
      <td>-0.006708</td>
    </tr>
    <tr>
      <th>25</th>
      <td>conference_code_ovc</td>
      <td>-0.091618</td>
    </tr>
    <tr>
      <th>26</th>
      <td>conference_code_pac_ten</td>
      <td>-0.637526</td>
    </tr>
    <tr>
      <th>27</th>
      <td>conference_code_pac_twelve</td>
      <td>-0.575800</td>
    </tr>
    <tr>
      <th>28</th>
      <td>conference_code_patriot</td>
      <td>-0.022216</td>
    </tr>
    <tr>
      <th>29</th>
      <td>conference_code_sec</td>
      <td>-0.921589</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>35</th>
      <td>conference_code_wac</td>
      <td>-0.123001</td>
    </tr>
    <tr>
      <th>36</th>
      <td>conference_code_wcc</td>
      <td>-0.881598</td>
    </tr>
    <tr>
      <th>37</th>
      <td>points_for</td>
      <td>1.961381</td>
    </tr>
    <tr>
      <th>38</th>
      <td>points_against</td>
      <td>1.921633</td>
    </tr>
    <tr>
      <th>39</th>
      <td>fg_for</td>
      <td>-3.866261</td>
    </tr>
    <tr>
      <th>40</th>
      <td>fg_against</td>
      <td>-3.884093</td>
    </tr>
    <tr>
      <th>41</th>
      <td>3pm_for</td>
      <td>-2.002830</td>
    </tr>
    <tr>
      <th>42</th>
      <td>3pm_against</td>
      <td>-1.899977</td>
    </tr>
    <tr>
      <th>43</th>
      <td>fga_for</td>
      <td>-0.055924</td>
    </tr>
    <tr>
      <th>44</th>
      <td>fga_against</td>
      <td>0.048797</td>
    </tr>
    <tr>
      <th>45</th>
      <td>3pa_for</td>
      <td>0.020423</td>
    </tr>
    <tr>
      <th>46</th>
      <td>3pa_against</td>
      <td>-0.010996</td>
    </tr>
    <tr>
      <th>47</th>
      <td>ft_for</td>
      <td>-1.924131</td>
    </tr>
    <tr>
      <th>48</th>
      <td>ft_against</td>
      <td>-1.950374</td>
    </tr>
    <tr>
      <th>49</th>
      <td>fta_for</td>
      <td>-0.034768</td>
    </tr>
    <tr>
      <th>50</th>
      <td>fta_against</td>
      <td>0.020514</td>
    </tr>
    <tr>
      <th>51</th>
      <td>off_rebounds_for</td>
      <td>0.058362</td>
    </tr>
    <tr>
      <th>52</th>
      <td>off_rebounds_against</td>
      <td>-0.049957</td>
    </tr>
    <tr>
      <th>53</th>
      <td>def_rebounds_for</td>
      <td>-0.029409</td>
    </tr>
    <tr>
      <th>54</th>
      <td>def_rebounds_against</td>
      <td>0.028335</td>
    </tr>
    <tr>
      <th>55</th>
      <td>assists_for</td>
      <td>-0.005415</td>
    </tr>
    <tr>
      <th>56</th>
      <td>assists_against</td>
      <td>-0.001259</td>
    </tr>
    <tr>
      <th>57</th>
      <td>steals_for</td>
      <td>0.004033</td>
    </tr>
    <tr>
      <th>58</th>
      <td>steals_against</td>
      <td>-0.003160</td>
    </tr>
    <tr>
      <th>59</th>
      <td>blocks_for</td>
      <td>0.005524</td>
    </tr>
    <tr>
      <th>60</th>
      <td>blocks_against</td>
      <td>0.012153</td>
    </tr>
    <tr>
      <th>61</th>
      <td>turnovers_for</td>
      <td>-0.016100</td>
    </tr>
    <tr>
      <th>62</th>
      <td>turnovers_against</td>
      <td>0.011652</td>
    </tr>
    <tr>
      <th>63</th>
      <td>fouls_for</td>
      <td>0.018368</td>
    </tr>
    <tr>
      <th>64</th>
      <td>fouls_against</td>
      <td>-0.009586</td>
    </tr>
  </tbody>
</table>
<p>65 rows × 2 columns</p>
</div>

<p>The AUC scores are more representative of the model's true performance. This basic logistic model was able to
be accurate 52% of the time with training data and 92% with test data. Therefore, it's a good benchmark, but
there is opportunity to improve the any over-fitting, and through feature engineering (advanced basketball metrics!)</p>
<p>Notice how the AUC score is much better now. With this model (trained on balanced classes), we are much better than a 'no information' classifier. In fact is very close to 1 so it does not display signals of imbalanced classes,
nor overwhelming amount of false positives vs false negatives. We'll revisit this later in model evaluation.</p>
<hr>
<h1>Exploratory Data Analysis</h1>
<p>Let us perform EDA to better understand our data. </p>
<h2>Summary Statistics</h2>
<h3>Correlation and Heatmap</h3>
<ul>
<li>Final_four is negatively correlated to seed (higher seed -&gt; less likely to be in final four)</li>
<li>
<p>Final_four is positively correlated to fg_for (higher fg_for -&gt; more likely to be in final four)</p>
<ul>
<li>Similar situation for blocks, assists, rebounds, points scored</li>
</ul>
</li>
<li>
<p>Some of these independent variables are highly correlated, so I may not want to use all of them to reduce over-fitting. </p>
<ul>
<li>For example, points_for is related with points against, so I may want to combine those in a points differential variable, and offensive efficiency will combine (assists_for, fg_for)</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">quant</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;final_four&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="s1">&#39;team_id&#39;</span><span class="p">,</span> <span class="s1">&#39;points_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;points_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;fga_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_against&#39;</span><span class="p">,</span> <span class="s1">&#39;ft_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;ft_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_against&#39;</span><span class="p">,</span> <span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;assists_for&#39;</span><span class="p">,</span> <span class="s1">&#39;assists_against&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_for&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;blocks_for&#39;</span><span class="p">,</span> <span class="s1">&#39;blocks_against&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_for&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;fouls_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fouls_against&#39;</span><span class="p">]]</span>

<span class="n">stats</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;points_for&#39;</span><span class="p">,</span><span class="s1">&#39;points_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fg_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pm_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;fga_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_against&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_for&#39;</span><span class="p">,</span> <span class="s1">&#39;3pa_against&#39;</span><span class="p">,</span> <span class="s1">&#39;ft_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;ft_against&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fta_against&#39;</span><span class="p">,</span> <span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">,</span>
       <span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">,</span> <span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;assists_for&#39;</span><span class="p">,</span> <span class="s1">&#39;assists_against&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_for&#39;</span><span class="p">,</span> <span class="s1">&#39;steals_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;blocks_for&#39;</span><span class="p">,</span> <span class="s1">&#39;blocks_against&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_for&#39;</span><span class="p">,</span> <span class="s1">&#39;turnovers_against&#39;</span><span class="p">,</span>
       <span class="s1">&#39;fouls_for&#39;</span><span class="p">,</span> <span class="s1">&#39;fouls_against&#39;</span><span class="p">]]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">quant</span><span class="o">.</span><span class="n">corr</span><span class="p">()[</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span>final_four              1.000000
season                 -0.088572
seed                   -0.671353
team_id                -0.047393
points_for              0.420668
points_against          0.279562
fg_for                  0.436103
fg_against              0.299363
3pm_for                 0.132419
3pm_against             0.156121
fga_for                 0.395567
fga_against             0.374804
3pa_for                 0.136840
3pa_against             0.471266
ft_for                  0.292254
ft_against             -0.066517
fta_for                 0.290864
fta_against            -0.047742
off_rebounds_for        0.409847
off_rebounds_against    0.254282
def_rebounds_for        0.474183
def_rebounds_against    0.084649
assists_for             0.432095
assists_against         0.081193
steals_for              0.276889
steals_against          0.158755
blocks_for              0.366486
blocks_against          0.141490
turnovers_for           0.166151
turnovers_against       0.269311
fouls_for               0.071425
fouls_against           0.310043
Name: final_four, dtype: float64
</pre></div>


<div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">with</span> <span class="n">sns</span><span class="o">.</span><span class="n">axes_style</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">yticklabels</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="images/ncaa_81_0.png"></p>
<div class="highlight"><pre><span></span><span class="c1"># stats.corr()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">quant</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>final_four</th>
      <th>season</th>
      <th>seed</th>
      <th>team_id</th>
      <th>points_for</th>
      <th>points_against</th>
      <th>fg_for</th>
      <th>fg_against</th>
      <th>3pm_for</th>
      <th>3pm_against</th>
      <th>...</th>
      <th>assists_for</th>
      <th>assists_against</th>
      <th>steals_for</th>
      <th>steals_against</th>
      <th>blocks_for</th>
      <th>blocks_against</th>
      <th>turnovers_for</th>
      <th>turnovers_against</th>
      <th>fouls_for</th>
      <th>fouls_against</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>...</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
      <td>1840.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.491304</td>
      <td>2009.733152</td>
      <td>5.902717</td>
      <td>1290.800000</td>
      <td>0.082170</td>
      <td>0.070945</td>
      <td>0.028971</td>
      <td>0.025257</td>
      <td>6.917975</td>
      <td>6.258598</td>
      <td>...</td>
      <td>15.264331</td>
      <td>12.244795</td>
      <td>7.338908</td>
      <td>6.283238</td>
      <td>4.388280</td>
      <td>3.265049</td>
      <td>13.204389</td>
      <td>14.603750</td>
      <td>18.038150</td>
      <td>19.742397</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.500060</td>
      <td>4.097770</td>
      <td>4.799378</td>
      <td>96.005048</td>
      <td>0.018478</td>
      <td>0.014926</td>
      <td>0.006705</td>
      <td>0.005426</td>
      <td>1.307789</td>
      <td>0.928820</td>
      <td>...</td>
      <td>2.119950</td>
      <td>1.523999</td>
      <td>1.476626</td>
      <td>0.985864</td>
      <td>1.502522</td>
      <td>0.623705</td>
      <td>1.836439</td>
      <td>2.214709</td>
      <td>2.020666</td>
      <td>1.847527</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>2003.000000</td>
      <td>1.000000</td>
      <td>1102.000000</td>
      <td>0.051165</td>
      <td>0.045878</td>
      <td>0.017784</td>
      <td>0.016117</td>
      <td>2.689655</td>
      <td>3.178571</td>
      <td>...</td>
      <td>9.354839</td>
      <td>7.676471</td>
      <td>3.451613</td>
      <td>3.387097</td>
      <td>0.655172</td>
      <td>1.451613</td>
      <td>7.387097</td>
      <td>8.857143</td>
      <td>12.029412</td>
      <td>14.545455</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.000000</td>
      <td>2006.000000</td>
      <td>2.000000</td>
      <td>1211.750000</td>
      <td>0.069122</td>
      <td>0.060210</td>
      <td>0.024268</td>
      <td>0.021358</td>
      <td>5.970588</td>
      <td>5.633333</td>
      <td>...</td>
      <td>13.812500</td>
      <td>11.170977</td>
      <td>6.330882</td>
      <td>5.616461</td>
      <td>3.300000</td>
      <td>2.812500</td>
      <td>12.029412</td>
      <td>13.090241</td>
      <td>16.771822</td>
      <td>18.468229</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.000000</td>
      <td>2010.000000</td>
      <td>4.000000</td>
      <td>1278.500000</td>
      <td>0.077424</td>
      <td>0.067318</td>
      <td>0.027189</td>
      <td>0.023993</td>
      <td>6.875000</td>
      <td>6.234314</td>
      <td>...</td>
      <td>15.200000</td>
      <td>12.156250</td>
      <td>7.183502</td>
      <td>6.241379</td>
      <td>4.107143</td>
      <td>3.214286</td>
      <td>13.190524</td>
      <td>14.343750</td>
      <td>18.062500</td>
      <td>19.646110</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.000000</td>
      <td>2013.000000</td>
      <td>10.000000</td>
      <td>1373.250000</td>
      <td>0.090343</td>
      <td>0.078396</td>
      <td>0.031852</td>
      <td>0.027799</td>
      <td>7.774194</td>
      <td>6.838710</td>
      <td>...</td>
      <td>16.608583</td>
      <td>13.176471</td>
      <td>8.133333</td>
      <td>6.900806</td>
      <td>5.261111</td>
      <td>3.645161</td>
      <td>14.299808</td>
      <td>15.831627</td>
      <td>19.243534</td>
      <td>20.847851</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.000000</td>
      <td>2017.000000</td>
      <td>16.000000</td>
      <td>1463.000000</td>
      <td>0.197555</td>
      <td>0.155237</td>
      <td>0.068938</td>
      <td>0.055339</td>
      <td>12.148148</td>
      <td>10.468750</td>
      <td>...</td>
      <td>23.958333</td>
      <td>17.625000</td>
      <td>12.500000</td>
      <td>11.041667</td>
      <td>10.962963</td>
      <td>5.793103</td>
      <td>20.875000</td>
      <td>23.708333</td>
      <td>25.111111</td>
      <td>27.916667</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 32 columns</p>
</div>

<p>While the team's season statistics are useful, it may be more predictive to understand a team's performance on a per game basis, to understand how it's winning or losing its games.</p>
<p>The main categorical variable is conferences. It appears to also be predictive from the baseline, representing the strength of the conference. Some conferences are generally very strong and play stronger competition than others.
* big_ten (Michigan State, Purdue, Michigan)
* big_twelve (Texas Tech, Kansas State)
* acc (Duke, UNC, Virgnia)</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">regular_season_total</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;conference_code&quot;</span><span class="p">)[</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span>
<span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;final_four&quot;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">))[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="c1"># See that big_east, acc, big_ten, sec, big_twelve all have 5+ teams that have made it to the final four</span>
<span class="c1"># These are the conferences with the best teams</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>final_four</th>
    </tr>
    <tr>
      <th>conference_code</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>big_east</th>
      <td>11</td>
    </tr>
    <tr>
      <th>acc</th>
      <td>10</td>
    </tr>
    <tr>
      <th>big_ten</th>
      <td>10</td>
    </tr>
    <tr>
      <th>sec</th>
      <td>9</td>
    </tr>
    <tr>
      <th>big_twelve</th>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>

<hr>
<h2>Data Visualization</h2>
<div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x_vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">quant</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">y_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;final_four&quot;</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.PairGrid at 0x11f8e9710&gt;
</pre></div>


<p><img alt="png" src="images/ncaa_88_1.png"></p>
<ul>
<li>Some observations include: <ul>
<li>No seeds greater than 11 have made it to final four</li>
<li>Teams which make the final four, in the regular season score more, make more FG, give up less FTs, rebound more, block more, foul less, ... all the attributes of a great basketball team</li>
</ul>
</li>
</ul>
<hr>
<h1>Feature Engineering</h1>
<h2>'Standardize' features</h2>
<p>Let's keep the stat metrics on the same scale, on a per game basis rather than standardizing to keep it interpretable. First we need to count the number of games for each team.</p>
<div class="highlight"><pre><span></span><span class="c1"># add a column vector to indicate a game was played</span>
<span class="n">regular</span><span class="p">[</span><span class="s2">&quot;game_played&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">regular</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1"># sum over games where they won</span>
<span class="c1"># sum over games where they lost</span>
<span class="c1"># sum w + l = total games played</span>

<span class="k">def</span> <span class="nf">games_won</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span> <span class="n">season</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;winning_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;winning_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;game_played&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span>

<span class="k">def</span> <span class="nf">games_lost</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span><span class="n">season</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">regular</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;losing_team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;losing_team_id=={team_id} &amp; season=={season}&#39;</span><span class="p">)[</span><span class="s2">&quot;game_played&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">i</span>


<span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_won&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                         <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> 
                               <span class="n">games_won</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                         <span class="n">df</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_lost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s2">&quot;team_id&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span>
                             <span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> 
                                   <span class="n">games_lost</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
                                             <span class="n">df</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_won&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_lost&quot;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Effective gf </span>
<span class="c1"># This statistic adjusts for the fact that a 3-point field goal is worth one more point than a 2-point field goal.</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;efg%&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;fg_for&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;3pm_for&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;fga_for&quot;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># NTS: time permitting re-factor with FunctionTransformer</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;points_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;points_for&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;points_against&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;points_against&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;fg_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fg_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;fg_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fg_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;fga_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fga_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;fga_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fga_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;3pm_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;3pm_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;3pm_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;3pm_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;3pa_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;3pa_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;3pa_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;3pa_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ft_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ft_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ft_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ft_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;fta_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fta_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;fta_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fta_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;off_rebounds_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;off_rebounds_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;def_rebounds_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;def_rebounds_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;assists_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;assists_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;assists_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;assists_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;steals_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;steals_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;steals_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;steals_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;blocks_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;blocks_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;blocks_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;blocks_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;turnovers_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;turnovers_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;turnovers_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;turnovers_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;fouls_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fouls_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;fouls_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fouls_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>
</pre></div>


<h2>Transform and add new features</h2>
<p>Let's use some advanced metrics from the NBA. 
Note, opponent % are kept as to gauge defense as well.</p>
<div class="highlight"><pre><span></span><span class="c1"># Now, instead of games_won and games_lost, let&#39;s combine this into win_%</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;win_%&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_won&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;games_total&quot;</span><span class="p">]</span>

<span class="c1"># +/- point differential aka margin of victory</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;margin_of_victory&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;points_for&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;points_against&quot;</span><span class="p">]</span>

<span class="c1"># Assist to turnover ratio: this measures your ability to care of possessions and pass the ball, as a team.</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;ast_to_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;assists_for&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;turnovers_for&quot;</span><span class="p">]</span>

<span class="c1"># Let&#39;s convert field goals, threes and fts into %. Will reduce collinearity and also simplify interpretation.</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;fg%_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fg_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;fga_for&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;fg%_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fg_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;fga_against&#39;</span><span class="p">]</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;3p%_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;3pm_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;3pa_for&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;3p%_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;3pm_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;3pa_against&#39;</span><span class="p">]</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ft%_for&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ft_for&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;fta_for&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ft%_against&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ft_against&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;fta_against&#39;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># drop games won, lost, its redundant with win_%</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;games_won&quot;</span><span class="p">,</span><span class="s2">&quot;games_lost&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># 33 games have no data, probably from SMOTE these teams don&#39;t exist. Let&#39;s just drop for now since I&#39;m getting NaN.</span>
<span class="c1"># df[df[&quot;win_%&quot;].isna()].index</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">1036</span><span class="p">,</span> <span class="mi">1049</span><span class="p">,</span> <span class="mi">1134</span><span class="p">,</span> <span class="mi">1150</span><span class="p">,</span> <span class="mi">1158</span><span class="p">,</span> <span class="mi">1187</span><span class="p">,</span> <span class="mi">1216</span><span class="p">,</span> <span class="mi">1299</span><span class="p">,</span> <span class="mi">1310</span><span class="p">,</span> <span class="mi">1341</span><span class="p">,</span> <span class="mi">1353</span><span class="p">,</span>
            <span class="mi">1361</span><span class="p">,</span> <span class="mi">1375</span><span class="p">,</span> <span class="mi">1389</span><span class="p">,</span> <span class="mi">1434</span><span class="p">,</span> <span class="mi">1444</span><span class="p">,</span> <span class="mi">1452</span><span class="p">,</span> <span class="mi">1492</span><span class="p">,</span> <span class="mi">1528</span><span class="p">,</span> <span class="mi">1530</span><span class="p">,</span> <span class="mi">1533</span><span class="p">,</span> <span class="mi">1572</span><span class="p">,</span>
            <span class="mi">1624</span><span class="p">,</span> <span class="mi">1643</span><span class="p">,</span> <span class="mi">1653</span><span class="p">,</span> <span class="mi">1711</span><span class="p">,</span> <span class="mi">1720</span><span class="p">,</span> <span class="mi">1749</span><span class="p">,</span> <span class="mi">1760</span><span class="p">,</span> <span class="mi">1783</span><span class="p">,</span> <span class="mi">1850</span><span class="p">,</span> <span class="mi">1851</span><span class="p">])</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>final_four</th>
      <th>season</th>
      <th>seed</th>
      <th>team_id</th>
      <th>conference_code_a_sun</th>
      <th>conference_code_a_ten</th>
      <th>conference_code_aac</th>
      <th>conference_code_acc</th>
      <th>conference_code_aec</th>
      <th>conference_code_big_east</th>
      <th>...</th>
      <th>efg%</th>
      <th>win_%</th>
      <th>margin_of_victory</th>
      <th>ast_to_ratio</th>
      <th>fg%_for</th>
      <th>fg%_against</th>
      <th>3p%_for</th>
      <th>3p%_against</th>
      <th>ft%_for</th>
      <th>ft%_against</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
<p>0 rows × 77 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./data/df.csv&quot;</span><span class="p">)</span>
<span class="n">X</span><span class="o">.</span><span class="n">shape</span> <span class="c1"># 1840 observations</span>
</pre></div>


<div class="highlight"><pre><span></span>(1872, 65)
</pre></div>


<p>I will keep the original features and use regularization methods in the next section.</p>
<hr>
<h1>Modelling</h1>
<h2>Logistic Regression with Regularization</h2>
<h3>L1: Lasso</h3>
<p>I prefer Lasso as a shrinkage method, to narrow down on the most important features, since our baseline model was very accurate already. </p>
<div class="highlight"><pre><span></span><span class="n">y_test</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">2015</span><span class="p">][</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">2015</span><span class="p">][</span><span class="s2">&quot;final_four&quot;</span><span class="p">]</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;season&lt;2015&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;season&quot;</span><span class="p">:</span><span class="s2">&quot;ft%_against&quot;</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;season&gt;=2015&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;season&quot;</span><span class="p">:</span><span class="s2">&quot;ft%_against&quot;</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1">#85%</span>
<span class="k">print</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1">#15%</span>

<span class="c1"># Instantiate Model</span>
<span class="n">logreg_lasso_1</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Fit model.</span>
<span class="n">logreg_lasso_1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Logistic Regression Intercept: {logreg_lasso_1.intercept_}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Logistic Regression Coefficient: {logreg_lasso_1.coef_}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Generate prediction values</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Number of teams making it to final four:{sum(logreg_lasso_1.predict(X_train))}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Generate predictions/probabilities</span>
<span class="k">print</span><span class="p">(</span><span class="n">logreg_lasso_1</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>(1571, 76)
(269, 76)
Logistic Regression Intercept: [0.]
Logistic Regression Coefficient: [[ 0.00141951 -0.77849273 -0.00025749  0.         -5.1456576  -1.70624789
  -4.80742667  0.         -4.83805072  0.          0.         -3.54071377
  -5.4726868   0.          0.         -3.56101615  0.87904808  0.
   0.          0.          0.          0.         -2.57593666 -5.10398929
   0.          0.         -3.1504727  -4.57699273  0.         -3.70504311
   0.          0.          0.          0.          0.         -0.88649024
  -4.78484248  0.          0.          0.          0.         -0.95946952
   0.42807337  0.          0.          0.46165073 -0.20879539  0.28420649
   0.00311739 -0.18050503 -0.18200272  0.16557446 -0.02631732  0.50236311
  -0.45055486 -0.00524669  0.05135045  0.3674497   0.03333877  0.02867236
   0.31202959 -0.25130464  0.03259512  0.3092104  -0.21813342  0.12577743
   0.         -8.48018843  0.          0.          0.          0.
   0.          0.          0.          0.        ]]


Number of teams making it to final four:829


[0.30300043 0.64610282 0.21053469 ... 0.99991704 0.99990243 0.6140518 ]
</pre></div>


<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">html</span>
<span class="o">&lt;</span><span class="n">style</span><span class="o">&gt;</span>
<span class="n">table</span> <span class="p">{</span><span class="nb">float</span><span class="p">:</span><span class="n">left</span><span class="p">}</span>
<span class="o">&lt;/</span><span class="n">style</span><span class="o">&gt;</span>
</pre></div>


<style>
table {float:left}
</style>

<h3>Interpretation of Coefficients</h3>
<div class="highlight"><pre><span></span><span class="n">lasso_coef</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">logreg_lasso_1</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])))</span>
<span class="n">lasso_coef</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span><span class="s2">&quot;coef&quot;</span><span class="p">]</span>
<span class="n">lasso_coef</span><span class="p">[</span><span class="s2">&quot;coef_abs&quot;</span><span class="p">]</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">lasso_coef</span><span class="p">[</span><span class="s2">&quot;coef&quot;</span><span class="p">])</span>
<span class="n">lasso_coef</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;coef_abs&quot;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">25</span><span class="p">]</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>variable</th>
      <th>coef</th>
      <th>coef_abs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>67</th>
      <td>win_%</td>
      <td>-8.480188</td>
      <td>8.480188</td>
    </tr>
    <tr>
      <th>12</th>
      <td>conference_code_big_twelve</td>
      <td>-5.472687</td>
      <td>5.472687</td>
    </tr>
    <tr>
      <th>4</th>
      <td>conference_code_a_ten</td>
      <td>-5.145658</td>
      <td>5.145658</td>
    </tr>
    <tr>
      <th>23</th>
      <td>conference_code_mwc</td>
      <td>-5.103989</td>
      <td>5.103989</td>
    </tr>
    <tr>
      <th>8</th>
      <td>conference_code_big_east</td>
      <td>-4.838051</td>
      <td>4.838051</td>
    </tr>
    <tr>
      <th>6</th>
      <td>conference_code_acc</td>
      <td>-4.807427</td>
      <td>4.807427</td>
    </tr>
    <tr>
      <th>36</th>
      <td>conference_code_wcc</td>
      <td>-4.784842</td>
      <td>4.784842</td>
    </tr>
    <tr>
      <th>27</th>
      <td>conference_code_pac_twelve</td>
      <td>-4.576993</td>
      <td>4.576993</td>
    </tr>
    <tr>
      <th>29</th>
      <td>conference_code_sec</td>
      <td>-3.705043</td>
      <td>3.705043</td>
    </tr>
    <tr>
      <th>15</th>
      <td>conference_code_cusa</td>
      <td>-3.561016</td>
      <td>3.561016</td>
    </tr>
    <tr>
      <th>11</th>
      <td>conference_code_big_ten</td>
      <td>-3.540714</td>
      <td>3.540714</td>
    </tr>
    <tr>
      <th>26</th>
      <td>conference_code_pac_ten</td>
      <td>-3.150473</td>
      <td>3.150473</td>
    </tr>
    <tr>
      <th>22</th>
      <td>conference_code_mvc</td>
      <td>-2.575937</td>
      <td>2.575937</td>
    </tr>
    <tr>
      <th>5</th>
      <td>conference_code_aac</td>
      <td>-1.706248</td>
      <td>1.706248</td>
    </tr>
    <tr>
      <th>41</th>
      <td>3pm_for</td>
      <td>-0.959470</td>
      <td>0.959470</td>
    </tr>
    <tr>
      <th>35</th>
      <td>conference_code_wac</td>
      <td>-0.886490</td>
      <td>0.886490</td>
    </tr>
    <tr>
      <th>16</th>
      <td>conference_code_horizon</td>
      <td>0.879048</td>
      <td>0.879048</td>
    </tr>
    <tr>
      <th>1</th>
      <td>seed</td>
      <td>-0.778493</td>
      <td>0.778493</td>
    </tr>
    <tr>
      <th>53</th>
      <td>def_rebounds_for</td>
      <td>0.502363</td>
      <td>0.502363</td>
    </tr>
    <tr>
      <th>45</th>
      <td>3pa_for</td>
      <td>0.461651</td>
      <td>0.461651</td>
    </tr>
    <tr>
      <th>54</th>
      <td>def_rebounds_against</td>
      <td>-0.450555</td>
      <td>0.450555</td>
    </tr>
    <tr>
      <th>42</th>
      <td>3pm_against</td>
      <td>0.428073</td>
      <td>0.428073</td>
    </tr>
    <tr>
      <th>57</th>
      <td>steals_for</td>
      <td>0.367450</td>
      <td>0.367450</td>
    </tr>
    <tr>
      <th>60</th>
      <td>blocks_against</td>
      <td>0.312030</td>
      <td>0.312030</td>
    </tr>
    <tr>
      <th>63</th>
      <td>fouls_for</td>
      <td>0.309210</td>
      <td>0.309210</td>
    </tr>
  </tbody>
</table>
</div>

<ul>
<li>
<p>Win_% is the most important predictor. Although it's strange to see that it has a negative sign, this is probably the case because schools that make to to the final four actually have lower win % than schools who do not make it to the final four because they face tougher competition (57% avg vs 72% avg). This supports the argument that which conference you play for is very important in predictive power. </p>
</li>
<li>
<p>Again, your strongest conferences, are the big_twelve, acc, big_ten. If you play in acc, your likelihood of reaching final four is very low, because you will likely be dominated by the top tier schools in those conferences. </p>
</li>
<li>
<p>In terms of regular season states, 3PM for and against is important, as the game continues to move shooting more threes, as it's been proven to be an effective strategy. </p>
</li>
<li>
<p>Lastly, seed is not to be overlooked as it's a good composite score for a team's strength, capturing a lot of regular season performance. As your seed increases by 1, your likelihood of reaching final four is 0.47x less. This makes sense... a 3 seed only has a ~10% (0.47^3) of making to final four! This is consistent with FiveThirtyEight's forecasts. Purdue, Houston, &amp; Texas Tech had 10-14% of making it to the Final four.</p>
</li>
<li>
<p>Similar to the NBA, margin of victory is a predictive variable though with a positive correlation. In the NBA, there is more parity since each team plays one another at least twice in a season, so individual team stats are more important than seed &amp; conference.</p>
</li>
</ul>
<hr>
<h2>Model Evaluation</h2>
<div class="highlight"><pre><span></span><span class="c1"># Score the model - accuracy</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg train accuracy: {cross_val_score(logreg_lasso_1, X_train, y_train, cv=5).mean()}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg test accuracy: {cross_val_score(logreg_lasso_1, X_test, y_test, cv=5).mean()}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Area under the curve</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Area under the curve: {roc_auc_score(y_test, logreg_lasso_1.predict_proba(X_test)[:,1])}&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>/Users/gc/anaconda3/lib/python3.6/site-packages/sklearn/svm/base.py:931: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  &quot;the number of iterations.&quot;, ConvergenceWarning)


 Logreg train accuracy: 0.9185457783772837


 Logreg test accuracy: 0.9073070325900513


 Area under the curve: 0.9681412337662337
</pre></div>


<table>
<thead>
<tr>
<th>Metric</th>
<th>Baseline</th>
<th>Logistic Regression, Lasso = 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>Train Accuracy</td>
<td>0.915</td>
<td>0.921</td>
</tr>
<tr>
<td>Test Accuracy</td>
<td>0.914</td>
<td>0.903</td>
</tr>
<tr>
<td>Area under the curve</td>
<td>0.940</td>
<td>0.961</td>
</tr>
</tbody>
</table>
<p>Even with many fewer variables, this model is arguably as performant as the original.
It does not overfit, and even improves the AUC score by 2% points.</p>
<div class="highlight"><pre><span></span><span class="c1"># create data frame of true values and predicted probabilities on test set</span>
<span class="n">pred_proba</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">logreg_lasso_1</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)]</span>

<span class="n">pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;true_values&#39;</span><span class="p">:</span> <span class="n">y_test</span><span class="p">,</span>
                        <span class="s1">&#39;pred_probs&#39;</span><span class="p">:</span><span class="n">pred_proba</span><span class="p">})</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Create figure.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="c1"># Create threshold values.</span>
<span class="n">thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="c1"># Define function to calculate sensitivity. (True positive rate.)</span>
<span class="k">def</span> <span class="nf">TPR</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">true_col</span><span class="p">,</span> <span class="n">pred_prob_col</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
    <span class="n">true_positive</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">true_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">pred_prob_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">false_negative</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">true_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">pred_prob_col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">true_positive</span> <span class="o">/</span> <span class="p">(</span><span class="n">true_positive</span> <span class="o">+</span> <span class="n">false_negative</span><span class="p">)</span>


<span class="c1"># Define function to calculate 1 - specificity. (False positive rate.)</span>
<span class="k">def</span> <span class="nf">FPR</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">true_col</span><span class="p">,</span> <span class="n">pred_prob_col</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
    <span class="n">true_negative</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">true_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">pred_prob_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">false_positive</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">true_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">pred_prob_col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">true_negative</span> <span class="o">/</span> <span class="p">(</span><span class="n">true_negative</span> <span class="o">+</span> <span class="n">false_positive</span><span class="p">))</span>

<span class="c1"># Calculate sensitivity &amp; 1-specificity for each threshold between 0 and 1.</span>
<span class="n">tpr_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">TPR</span><span class="p">(</span><span class="n">pred_df</span><span class="p">,</span> <span class="s1">&#39;true_values&#39;</span><span class="p">,</span> <span class="s1">&#39;pred_probs&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">)</span> <span class="k">for</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">]</span>
<span class="n">fpr_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">FPR</span><span class="p">(</span><span class="n">pred_df</span><span class="p">,</span> <span class="s1">&#39;true_values&#39;</span><span class="p">,</span> <span class="s1">&#39;pred_probs&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">)</span> <span class="k">for</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">]</span>

<span class="c1"># Plot ROC curve.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_values</span><span class="p">,</span> <span class="c1"># False Positive Rate on X-axis</span>
         <span class="n">tpr_values</span><span class="p">,</span> <span class="c1"># True Positive Rate on Y-axis</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ROC Curve&#39;</span><span class="p">)</span>

<span class="c1"># Plot baseline. (Perfect overlap between the two populations.)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
         <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span>
         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Label axes.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;ROC Curve with AUC = {round(roc_auc_score(pred_df[&quot;true_values&quot;], pred_df[&quot;pred_probs&quot;]),2)}&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sensitivity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;1 - Specificity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="c1"># Create legend.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="images/ncaa_114_0.png"></p>
<div class="highlight"><pre><span></span><span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">logreg_lasso_1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
<span class="n">cm_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;predicted negative&#39;</span><span class="p">,</span> <span class="s1">&#39;predicted positive&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;actual negative&#39;</span><span class="p">,</span> <span class="s1">&#39;actual positive&#39;</span><span class="p">])</span>
<span class="n">cm_df</span>
<span class="c1"># more false negatives than false positives</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>predicted negative</th>
      <th>predicted positive</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>actual negative</th>
      <td>183</td>
      <td>9</td>
    </tr>
    <tr>
      <th>actual positive</th>
      <td>7</td>
      <td>70</td>
    </tr>
  </tbody>
</table>
</div>

<h2>Hyperparameter Selection</h2>
<p>Let's fine tune our hyperparameter of alpha with GridSearchCV to see if we can improve our model further.</p>
<div class="highlight"><pre><span></span><span class="n">log_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;penalty&#39;</span><span class="p">:[</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="s2">&quot;l2&quot;</span><span class="p">],</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">log_gridsearch</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span> <span class="n">log_params</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">log_gridsearch</span> <span class="o">=</span> <span class="n">log_gridsearch</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>Fitting 5 folds for each of 20 candidates, totalling 100 fits


[Parallel(n_jobs=2)]: Using backend LokyBackend with 2 concurrent workers.
[Parallel(n_jobs=2)]: Done  46 tasks      | elapsed:   14.6s
[Parallel(n_jobs=2)]: Done 100 out of 100 | elapsed:   33.5s finished
</pre></div>


<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">log_gridsearch</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
<span class="n">log_gridsearch</span><span class="o">.</span><span class="n">best_params_</span>
</pre></div>


<div class="highlight"><pre><span></span>0.9325270528325907





{&#39;C&#39;: 5.0, &#39;penalty&#39;: &#39;l1&#39;}
</pre></div>


<div class="highlight"><pre><span></span><span class="n">log_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;penalty&#39;</span><span class="p">:[</span><span class="s2">&quot;l1&quot;</span><span class="p">],</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">log_gridsearch</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span> <span class="n">log_params</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">log_gridsearch</span> <span class="o">=</span> <span class="n">log_gridsearch</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>Fitting 5 folds for each of 10 candidates, totalling 50 fits


[Parallel(n_jobs=2)]: Using backend LokyBackend with 2 concurrent workers.
[Parallel(n_jobs=2)]: Done  50 out of  50 | elapsed:   26.1s finished
</pre></div>


<div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">lst_of_c</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">log_gridsearch</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)[</span><span class="s2">&quot;params&quot;</span><span class="p">]]</span>
<span class="n">mean_test_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">log_gridsearch</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)[</span><span class="s2">&quot;mean_test_score&quot;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lst_of_c</span><span class="p">,</span> 
         <span class="n">mean_test_scores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Penalty Strength vs Test Accuracy: {round(log_gridsearch.best_score_,3)}&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>Text(0.5, 0, &#39;%&#39;)
</pre></div>


<p><img alt="png" src="images/ncaa_120_1.png"></p>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">log_gridsearch</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
<span class="n">log_gridsearch</span><span class="o">.</span><span class="n">best_params_</span>
</pre></div>


<div class="highlight"><pre><span></span>0.9325270528325907





{&#39;C&#39;: 5.0, &#39;penalty&#39;: &#39;l1&#39;}
</pre></div>


<h2>Best Model</h2>
<div class="highlight"><pre><span></span><span class="c1"># Instantiate Model</span>
<span class="n">logreg_best</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">log_gridsearch</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">])</span>

<span class="c1"># Fit model.</span>
<span class="n">logreg_best</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Generate prediction values</span>
<span class="n">yhat_train</span> <span class="o">=</span> <span class="n">logreg_lasso_1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">yhat_test</span> <span class="o">=</span> <span class="n">logreg_lasso_1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Generate predictions/probabilities</span>
<span class="n">yhat_train_proba</span> <span class="o">=</span> <span class="n">logreg_best</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">yhat_test_proba</span> <span class="o">=</span> <span class="n">logreg_best</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Score the model - accuracy</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg train accuracy: {cross_val_score(logreg_best, X_train, y_train, cv=5).mean()}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Logreg test accuracy: {cross_val_score(logreg_best, X_test, y_test, cv=5).mean()}&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Area under the curve</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39; Area under the curve: {roc_auc_score(y_test, logreg_best.predict_proba(X_test)[:,1])}&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span> Logreg train accuracy: 0.9319095069161205




/Users/gc/anaconda3/lib/python3.6/site-packages/sklearn/svm/base.py:931: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  &quot;the number of iterations.&quot;, ConvergenceWarning)


 Logreg test accuracy: 0.9187650085763295


 Area under the curve: 0.9662472943722944


/Users/gc/anaconda3/lib/python3.6/site-packages/sklearn/svm/base.py:931: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  &quot;the number of iterations.&quot;, ConvergenceWarning)
</pre></div>


<table>
<thead>
<tr>
<th>Metric</th>
<th>Baseline</th>
<th>Logistic Regression, Lasso = 1</th>
<th>Logistic Regression, Lasso = Optimal</th>
</tr>
</thead>
<tbody>
<tr>
<td>Train Accuracy</td>
<td>0.915</td>
<td>0.921</td>
<td>0.936</td>
</tr>
<tr>
<td>Test Accuracy</td>
<td>0.914</td>
<td>0.903</td>
<td>0.918</td>
</tr>
<tr>
<td>Area under the curve</td>
<td>0.940</td>
<td>0.961</td>
<td>0.966</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><span class="n">pred_15_17</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">X_test</span><span class="p">[[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;team_id&quot;</span><span class="p">]],</span><span class="n">yhat_test</span><span class="p">))</span>
<span class="n">pred_15_17</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;season&quot;</span><span class="p">:</span> <span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">],</span>
     <span class="s2">&quot;team_id&quot;</span><span class="p">:</span> <span class="n">X_test</span><span class="p">[</span><span class="s2">&quot;team_id&quot;</span><span class="p">],</span>
     <span class="s2">&quot;final_four&quot;</span><span class="p">:</span> <span class="n">y_test</span><span class="p">,</span>
     <span class="s2">&quot;yhat&quot;</span><span class="p">:</span> <span class="n">yhat_test</span>  
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pred_15_17</span><span class="p">,</span><span class="n">teams</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">,</span><span class="s2">&quot;team_id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;final_four&quot;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>---------------------------------------------------------------------------

NameError                                 Traceback (most recent call last)

&lt;ipython-input-274-5393da1d7061&gt; in &lt;module&gt;
----&gt; 1 results = pd.merge(pred_15_17,teams, how=&quot;left&quot;,on=[&quot;season&quot;,&quot;team_id&quot;]).drop_duplicates().reset_index()
      2 results.sort_values(by=&quot;final_four&quot;,ascending=False).drop(&quot;index&quot;,axis=1)
      3 results.head()


NameError: name &#39;pred_15_17&#39; is not defined
</pre></div>


<hr>
<h1>Results</h1>
<p>Overall, I was able to improve from the baseline logistic model, by 1.5% in train accuracy, 0% in test accuracy, and 2.6% in ROC curve. What I am impressed about is that the best model via Lasso is able to predict with less variables, while also maintaining interpretability (no wild transformations). </p>
<p>In summary:</p>
<ul>
<li>
<p>Win_% is the most important predictor. Although it's strange to see that it has a negative sign, this is probably the case because schools that make to to the final four actually have lower win % than schools who do not make it to the final four because they face tougher competition (57% avg vs 72% avg). This supports the argument that which conference you play for is very important in predictive power. </p>
</li>
<li>
<p>Again, your strongest conferences, are the big_twelve, acc, big_ten. If you play in acc, your likelihood of reaching final four is very low, because you will likely be dominated by the top tier schools in those conferences. </p>
</li>
<li>
<p>In terms of regular season states, 3PM for and against is important, as the game continues to move shooting more threes, as it's been proven to be an effective strategy. </p>
</li>
<li>
<p>Lastly, seed is not to be overlooked as it's a good composite score for a team's strength, capturing a lot of regular season performance. As your seed increases by 1, your likelihood of reaching final four is 0.47x less. This makes sense... a 3 seed only has a ~10% (0.47^3) of making to final four! This is consistent with FiveThirtyEight's forecasts. Purdue, Houston, &amp; Texas Tech had 10-14% of making it to the Final four.</p>
</li>
<li>
<p>Similar to the NBA, margin of victory is a predictive variable though with a positive correlation. In the NBA, there is more parity since each team plays one another at least twice in a season, so individual team stats are more important than seed &amp; conference.</p>
</li>
</ul>
<p>My model predicts the probability of a team reaching the final four, primarily based on its regular season data, seed, and conference. I would recommend coaches to develop the three ball ability, as it continues dominate in the NBA and at the college level, and to outperform in the regular season to improve your seeding, to ultimately improve your chances in moving to the final four, through playing weaker opponents. </p>
<p>Assumptions 
* In this model, there are things that we cannot predict, including injuries, player specific data, draft prospects, travel &amp; time between games (are players are well rested?), coaches track record, momentum of a team firing on all cylinders (last 10 games), given the absence of data.</p>
<ul>
<li>In this example, there isn't a penalty on false positives vs false negatives, as wrong is wrong. Predicting a loser who won isn't worse than a winner that lost. There may be implications in gambling, but that's out of scope. </li>
</ul>
<p>Research Links
* https://projects.fivethirtyeight.com/2019-march-madness-predictions/ </p>
<hr>
<h2>Next Steps</h2>
<p>This was a very fun exploration and may plan to revisit this project in a future blog post.</p>
<p>Ideas:
* Simulating winner between 2 games (or at the very least, the final four), using a Poisson model for pts scored
* Logistic vs Non Parametric (KNN, SVM, random forests)
* Scrap 2018 data, and run model, and add graphs (with SMOTE, 2015-&gt;2017 data is obfuscated)
* Feature engineer strength of schedule (they have this on sports reference)
* ELO
* No. of previous appearances in history
* Confidence intervals of predicted probabilities</p>
  </div>



      <div class="footer">
<div class="disclaimer">

    <p>
      © Garry Chan 2019 &mdash; built with <a href="http://getpelican.com" target="_blank">Pelican</a>, built off of the theme <a href="https://github.com/swanson/lagom" target="_blank">Lagom</a>.
    </p>
  </div>      </div>
    </div>
  </div>

<!-- my kit for font awesome  -->
<script src="https://kit.fontawesome.com/54282dd713.js"></script>
</body>
</html>